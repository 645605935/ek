<include file="Public/header"/>
    <!-- basic styles -->
    <link href="__PUBLIC__/Admin/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome.min.css" />

    <!--[if IE 7]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome-ie7.min.css" />
    <![endif]-->

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.custom.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/chosen.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/bootstrap-timepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/daterangepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/colorpicker.css" />

    <!-- 模块jqgrid  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.full.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ui.jqgrid.css" />
    <!-- 模块jqgrid  end -->

    <!-- fonts -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/assets/css/google_font_css.css">

    <!-- ace styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-rtl.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-skins.min.css" />

    <!-- jQuery smartMenu右键自定义上下文菜单插件  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/jquery-smartMenu/css/smartMenu.css" type="text/css" />
    <!-- jQuery smartMenu右键自定义上下文菜单插件  end -->

    <link rel="stylesheet" href="__PUBLIC__/Admin/layui-v1.0.4/layui/css/layui.css"  media="all">
    <link rel="stylesheet" href="__PUBLIC__/Admin/css/my_diy_css.css"  media="all">

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-ie.min.css" />
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->

    <script src="__PUBLIC__/Admin/assets/js/ace-extra.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.min.js"></script>
    <!-- layui.js   -->
    <script src="__PUBLIC__/Admin/layui-v1.0.4/layui/layui.js"></script>
    <script src="__PUBLIC__/layer/layer.js"></script>
<script>



</script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->



    <!--[if lt IE 9]>

    <script src="__PUBLIC__/Admin/assets/js/html5shiv.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/respond.min.js"></script>

    <![endif]-->

  </head>

  <body>
    <div class="navbar navbar-default" id="navbar">
      <include file="Public/navbar"/>
    </div>

    <div class="main-container" id="main-container">

      <script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
      </script>

      <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
          <span class="menu-text"></span>
        </a>

        <!-- 左侧菜单栏 start-->
        <div class="sidebar" id="sidebar">
          <include file="Public/left"/>
        </div>

        <!-- 右侧主要内容 start-->
        <div class="main-content" style="overflow: hidden;">


          <!-- 右block_1  start -->
          <div class="breadcrumbs" id="breadcrumbs">
            <script type="text/javascript">
              try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
            </script>

            <ul class="breadcrumb">
              <include file="Public/_breadcrumb"/>
            </ul><!-- .breadcrumb -->

            <div class="nav-search" id="nav-search">
              <form class="form-search">
                <span class="input-icon">
                  <input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
                  <i class="icon-search nav-search-icon"></i>
                </span>
              </form>
            </div><!-- #nav-search -->
          </div>
          <!-- 右block_1  end -->

          <div class="page-content">

            <div class="row">
              <div class="col-xs-12">
                <style>
                  .layui-form-item{margin-bottom: 0px;}
                  #gbox_grid-table{width: 100%!important;}
                  #gview_grid-table{width: 100%!important;}
                  #gview_grid-table>div{width: 100%!important;}
                  #trv_Modify,#trv_Delete,#trv_Show{display: none;}
                </style>

                <!-- 权限设置  start -->
                <div class="row">
                  <include file="Public/role_page_setting"/>
                </div>
                <!-- 权限设置  end -->

                <!-- 搜索  start -->
                <div class="row">
                    <form class="layui-form layui-form-pane col-xs-12" action="" method="post" id="form_search_0">

                        <table class="layui-table" id="search_table">
                          <thead>
                            <tr>
                              <th><i class="icon-search smaller-90"></i>搜索</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>
                                  <div class="layui-inline">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">板料名称</label>
                                      <div class="layui-input-inline B_Name_select_box">
                                        <select name="B_Name" class="B_Name B_Name_select" lay-filter="B_Name_select">
                                          <option value="请选择">全部</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="layui-inline">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">板料编号</label>
                                      <div class="layui-input-inline B_Number_select_box">
                                        <select name="B_Number" class="B_Number B_Number_select" lay-filter="B_Number_select">
                                          <option value="请选择">全部</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="layui-inline">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">消耗日期</label>
                                      <div class="layui-input-inline">
                                        <input class="layui-input Date1 date_time" name="Date1" value="" placeholder="开始日">
                                      </div>
                                      <div class="layui-input-inline">
                                        <input class="layui-input Date2 date_time" name="Date2" value="" placeholder="截止日">
                                      </div>
                                    </div>
                                  </div>

                                  <div class="layui-inline">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">用途</label>
                                      <div class="layui-input-inline">
                                        <select class="Usefor" name="Usefor">
                                          <option value="生产" selected>生产</option>
                                          <option value="调试">调试</option>
                                          <option value="试验">试验</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>
                              </td>
                            </tr>
                          </tbody>
                          <tfoot>
                            <tr>
                              <td>
                                <button style="float:right;" class="layui-btn demo1_search_0" lay-submit="" lay-filter="demo1_search_0">搜索</button>
                              </td>
                            </tr>
                          </tfoot>
                        </table>
                    </form>
                </div>
                <!-- 搜索  end -->

                <!-- PAGE CONTENT BEGINS -->
                <div class="row">
                    <div class="col-xs-12" id="grid-table-0-box">
                        <!-- <table id="grid-table-0"></table>
                        <div id="grid-pager-0"></div> -->
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12">
                        <div class="panel panel-default">
                          <div class="panel-heading">堆柱状图</div>
                          <div class="panel-body">
                            <div id="echart_pie" href="javascript:;" class="weui_grid js_grid" data-id="toast" style="height:300px;width:100%;"></div>
                          </div>
                        </div>
                    </div>
                </div>


                <!-- 搜索  start -->
                <div class="row">
                    <form class="layui-form layui-form-pane col-xs-12" action="" method="post" id="form_search">

                        <table class="layui-table" id="search_table">
                          <thead>
                            <tr>
                              <th><i class="icon-search smaller-90"></i>搜索</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>
                                  <div class="layui-inline">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">板料名称</label>
                                      <div class="layui-input-inline B_Name_select_box_2">
                                        <select name="B_Name" class="B_Name B_Name_select" lay-filter="B_Name_select_2">
                                          <option value="请选择">全部</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="layui-inline">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">板料编号</label>
                                      <div class="layui-input-inline B_Number_select_box_2">
                                        <select name="B_Number" class="B_Number B_Number_select" lay-filter="B_Number_select_2">
                                          <option value="请选择">全部</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>

                                  <!-- <div class="layui-inline" style="margin-top: 5px;">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">板料名称</label>
                                      <div class="layui-input-inline">
                                        <select name="BordName" class="BordName" id="bl_name_select">
                                          <option value="请选择">全部</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="layui-inline" style="margin-top: 5px;">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">板料编号</label>
                                      <div class="layui-input-inline">
                                        <select name="PartNumber" class="PartNumber" id="PartNumber_select">
                                          <option value="请选择">全部</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div> -->

                                  <div class="layui-inline" style="margin-top: 5px;">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">板料条码</label>
                                      <div class="layui-input-inline">
                                        <input type="text" name="Code" value="{$_POST['Code']}" placeholder="请输入" autocomplete="off" class="layui-input Code">
                                      </div>
                                    </div>
                                  </div>

                                  <div class="layui-inline" style="margin-top: 5px;">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">时间范围</label>
                                      <div class="layui-input-inline">
                                        <input class="layui-input Date1 date_time" name="Date1" placeholder="开始日">
                                      </div>
                                      <div class="layui-input-inline">
                                        <input class="layui-input Date2 date_time" name="Date2" placeholder="截止日">
                                      </div>
                                    </div>
                                  </div>

                                  <div class="layui-inline" style="margin-top: 5px;">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">材料厂家</label>
                                      <div class="layui-input-inline">
                                        <input class="layui-input Cailiaofactory" name="Cailiaofactory" value="{$_POST['Cailiaofactory']}" placeholder="材料厂家">
                                      </div>
                                    </div>
                                  </div>

                                  <div class="layui-inline" style="margin-top: 5px;">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">状态</label>
                                      <div class="layui-input-inline">
                                        <select name="Status" class="Status">
                                          <option value="请选择">全部</option>
                                          <option value="未检查" <if condition="$_POST['Status'] eq '未检查'">selected</if>>未检查</option>
                                          <option value="待判定" <if condition="$_POST['Status'] eq '待判定'">selected</if>>待判定</option>
                                          <option value="合格" <if condition="$_POST['Status'] eq '合格'">selected</if>>合格</option>
                                          <option value="不合格" <if condition="$_POST['Status'] eq '不合格'">selected</if>>不合格</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="layui-inline">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">用途</label>
                                      <div class="layui-input-inline">
                                        <select class="Usefor" name="Usefor">
                                          <option value="生产">生产</option>
                                          <option value="调试">调试</option>
                                          <option value="试验">试验</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>

                              </td>
                            </tr>
                          </tbody>
                          <tfoot>
                            <tr>
                              <td>
                                <button style="float:left;" type="button" class="layui-btn export_list" id="export_list" title="export_list">导出</button>

                                <button style="float:right;" class="layui-btn demo1_search" lay-submit="" lay-filter="demo1_search">搜索</button>
                              </td>
                            </tr>
                          </tfoot>
                        </table>
                    </form>
                </div>
                <!-- 搜索  end -->

                <!-- PAGE CONTENT BEGINS -->
                <div class="row">
                    <div class="col-xs-12" id="grid-table-box">
                        <!-- <table id="grid-table"></table>
                        <div id="grid-pager"></div> -->
                    </div>
                </div>

                <!-- PAGE CONTENT ENDS -->
              </div><!-- /.col -->
            </div><!-- /.row -->
          </div><!-- /.page-content -->

        </div><!-- /.main-content -->
        <!-- 右侧主要内容 end-->



        <!-- 模板相关设置 -->
        <include file="Public/ace-settings-container"/>

      </div><!-- /.main-container-inner -->



      <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">

        <i class="icon-double-angle-up icon-only bigger-110"></i>

      </a>

    </div><!-- /.main-container -->

    <!-- 底栏版本说明 -->
    <include file="Public/footer"/>

    <!-- basic scripts -->

    <!--[if !IE]> -->



    <!-- <![endif]-->



    <!--[if IE]>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<![endif]-->



    <!--[if !IE]> -->



    <script type="text/javascript">

      window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");

    </script>



    <!-- <![endif]-->



    <!--[if IE]>

<script type="text/javascript">

 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");

</script>

<![endif]-->



    <script type="text/javascript">

      if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");

    </script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/typeahead-bs2.min.js"></script>



    <!-- page specific plugin scripts -->

    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.custom.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/chosen.jquery.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/fuelux/fuelux.spinner.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-timepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/moment.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/daterangepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-colorpicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.knob.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.autosize.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.inputlimiter.1.3.1.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.maskedinput.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-tag.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.bootstrap.js"></script>

    <!-- 模块jqgrid  start -->
    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/jquery.jqGrid.min.js"></script>
    <!-- <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-en.js"></script> -->
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-zh.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.full.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>
    <!-- 模块jqgrid  end -->

    <!-- ace scripts -->



    <script src="__PUBLIC__/Admin/assets/js/ace-elements.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/ace.min.js"></script>



    <!-- inline scripts related to this page -->


    <script type="text/javascript">
      //数据列表初使化
      jQuery.support.cors=true;

      //获取列表
      function _ajax_list_gridTable_0(data){
          var gridData;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=4091',
              data:data,
              dataType : 'json',
              success  : function(json) {
                  if(json.code==0){
                      render_gridTable_0(json.data);
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {
                  layer.msg(json.msg);
              }
          });
          return gridData;
      }

      //获取列表
      function _ajax_list_gridTable(data){
          var gridData;
	      	$.ajax({
	      	    async:false,
	      	    type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=40921',
              data:data,
	      	    dataType : 'json',
	      	    success  : function(json) {
	      	        if(json.code==0){
                      render_gridTable(json.data);
	      	        }else{
	      	            layer.msg(json.msg);
	      	        }
	      	    },
	      	    error  : function(json) {
	      	        layer.msg(json.msg);
	      	    }
	      	});
	      	return gridData;
      }


      //自定义报警列格式
      function CheckFlagFormatter(cellvalue, options, rowdata){
          if(cellvalue=="合格"){
              return "<button class='btn btn-normal btn-xs id-btn-dialog2_status' data-id='"+rowdata.ProjectDetailID+"' data-Num='"+rowdata.Number+"' data-CheckDescribe='"+rowdata.CheckDescribe+"' title='id-btn-dialog2_status'>"+cellvalue+"</button>";
          }
          if(cellvalue=="不合格"){
              return "<button class='btn btn-normal btn-xs id-btn-dialog2_status' data-id='"+rowdata.ProjectDetailID+"' data-Num='"+rowdata.Number+"' data-CheckDescribe='"+rowdata.CheckDescribe+"' title='id-btn-dialog2_status'>"+cellvalue+"</button>";
          }
          if(cellvalue=="报废"){
              return "<button class='btn btn-success btn-xs id-btn-dialog2_status' data-id='"+rowdata.ProjectDetailID+"' data-Num='"+rowdata.Number+"' data-CheckDescribe='"+rowdata.CheckDescribe+"' title='id-btn-dialog2_status'>"+cellvalue+"</button>";
          }
          if(cellvalue=="已删除"){
              return "<button class='btn btn-info btn-xs id-btn-dialog2_status' data-id='"+rowdata.ProjectDetailID+"' data-Num='"+rowdata.Number+"' data-CheckDescribe='"+rowdata.CheckDescribe+"' title='id-btn-dialog2_status'>"+cellvalue+"</button>";
          }
      }


      function render_gridTable(gridData){
            $('#grid-table-box').html('<table id="grid-table"></table><div id="grid-pager"></div>');

            $(grid_selector).jqGrid({
              caption: "追溯列表",
              data: gridData,
              datatype: "local",
              height: 430,
              colNames:['ID','ProjectDetailID', '板料名称','板料编号','板料条码','数量（片）',
                        '材料厂家','记录时间','入库时间','状态','工单号',
                        '合格数量（片）','不合格数量（片）','报废数量（片）','原因描述','来源',
                        '操作'],
              colModel:[
                {name:'ID',index:'ID',  sorttype:"int",align : "center", hidden: true},
                {name:'ProjectDetailID',index:'ProjectDetailID',  sorttype:"int",align : "center", hidden: true},

                {name:'BoardName',index:'BoardName',align : "center"},
                {name:'PartNumber',index:'PartNumber',align : "center"},
                {name:'Code',index:'Code',align : "center"},
                {name:'Num',index:'Num',align : "center"},
                {name:'CaiLiaoFactory',index:'CaiLiaoFactory',align : "center"},
                {name:'ConsumDate',index:'ConsumDate', align : "center"},
                {name:'StorageTime',index:'StorageTime', align : "center"},
                {name:'Status',index:'Status',align:"center", formatter: CheckFlagFormatter },
                {name:'OrderID',index:'OrderID',align : "center"},

                {name:'QualifiedNum',index:'QualifiedNum',align : "center"},
                {name:'UnQualifiedNum',index:'UnQualifiedNum',align : "center"},
                {name:'FailureNum',index:'FailureNum',align : "center"},
                {name:'UnQualifiedDescribe',index:'UnQualifiedDescribe',align : "center"},
                {name:'Source',index:'Source',align : "center"},

                {name:'options',index:'options',align:'center', hidden: true}
              ],
              rownumbers:true,
              rownumWidth:50,//设置行号列宽度
              autowidth:true,
              shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
              viewrecords : true,
              rowNum:10,
              rowList:[10,20,30],
              pager : pager_selector,
              altRows: true,
              multiselect: true,
              multiboxonly: true,

              loadComplete : function() {
                var table = this;
                setTimeout(function(){
                  updatePagerIcons(table);
                }, 0);
              },
              gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
                  var ids=jQuery(grid_selector).jqGrid('getDataIDs');
                  for(var i=0; i<ids.length; i++){
                      var id=ids[i];

                      var options="";
                      options += "<button class='btn btn-primary btn-xs id-btn-dialog2_bl_info' style='margin-right:5px;'><i class='icon-edit bigger-110'></i>追溯</button>";
                      options += "<button class='btn btn-danger btn-xs row_del'><i class='icon-trash bigger-110'></i>撤销</button>";
                      jQuery(grid_selector).jqGrid('setRowData', ids[i], { options: options });
                  }
              }
            });
      }

      function render_gridTable_0(gridData){
            $('#grid-table-0-box').html('<table id="grid-table-0"></table><div id="grid-pager-0"></div>');

            $('#grid-table-0').jqGrid({
              caption: "板料消耗列表",
              data: gridData,
              datatype: "local",
              height: 430,

              colNames:['板料名称', '板料编号', '标签板料数量', '当前库存板料数量', '剩余不合格板料数量','报废数量','已消耗数量','板料年使用量'],
              colModel:[
                {name:'B_Name',index:'B_Name',align : "center"},
                {name:'B_Number',index:'B_Number',align : "center"},
                {name:'Number',index:'Number',align : "center"},
                {name:'QualifiedNum',index:'QualifiedNum',align : "center"},
                {name:'UnqualifiedNum',index:'UnqualifiedNum',align : "center"},
                {name:'BaofeiNum',index:'BaofeiNum',align : "center"},
                {name:'ConsumNum',index:'ConsumNum',align : "center"},
                {name:'YearUseNUm',index:'YearUseNUm', align : "center"}
              ],
              rownumbers:true,
              rownumWidth:50,//设置行号列宽度
              autowidth:true,
              shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
              viewrecords : true,
              rowNum:10,
              rowList:[10,20,30],
              pager : '#grid-pager-0',
              altRows: true,
              multiselect: true,
              multiboxonly: true,

              loadComplete : function() {
                var table = this;
                setTimeout(function(){
                  updatePagerIcons(table);
                }, 0);
              },

              onSelectRow : function(id) {
                  var _rowData = $('#grid-table-0').jqGrid('getRowData',id);

                  var B_Name=_rowData.B_Name;
                  var B_Number=_rowData.B_Number;
                  var Date1=$('#form_search_0 .Date1').val();
                  var Date2=$('#form_search_0 .Date2').val();

                  if(B_Name&&B_Number){
                      render_gridTable();
                      _ajax_bl_name_list_2(B_Number);//搜索板料名称渲染
                      _ajax_bl_number_list_2(B_Name);//搜索零件名称渲染
                      _ajax_Usefor_list_2($('#form_search_0 .Usefor').val());

                      $('#form_search .Date1').val(Date1);
                      $('#form_search .Date2').val(Date2);

                      layui.form().render();
                      $('.demo1_search').trigger('click');
                  }
              }
            });
      }
    </script>

    <!-- 模板引擎doT.js    start -->
    <script id="j-tmpl" type="text/template">
        <tr>
          <td class="center">
            <div class="layui-inline">
              <div class="layui-form-item">
                <div class="layui-input-inline">
                  <input type="text" name="keyword" lay-verify="required" placeholder="来料计划编号" autocomplete="off" class="layui-input item-1">
                </div>
              </div>
            </div>
          </td>
          <td>
            <div class="layui-inline">
              <div class="layui-form-item">
                <div class="layui-input-inline">
                  <input type="text" name="keyword" lay-verify="required" placeholder="来料名称" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-2">
                </div>
              </div>
            </div>
            <div class="layui-inline" style="display:none;">
              <div class="layui-form-item">
                <div class="layui-input-inline">
                  <input type="text" name="keyword" lay-verify="required" placeholder="" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-3">
                </div>
              </div>
            </div>
          </td>
          <td>
            <div class="layui-inline">
              <div class="layui-form-item">
                <div class="layui-input-inline">
                  <input type="text" name="keyword" lay-verify="required" placeholder="数量" autocomplete="off" class="layui-input item-4">
                </div>
              </div>
            </div>
          </td>
          <td>
          </td>
        </tr>
    </script>

    <script id="j-tmpl-bl-list" type="text/template">

        {{ if(it.code == 0){ }}

                {{ for (var i = 0, l = it.data.length; i < l; i++) { }}

                      <tr data-ProjectDetailID="{{=it.data[i].ProjectDetailID}}">
                        <td class="center">{{=i+1}}</td>
                        <td>
                            <input type="checkbox" name="" value="" />
                        </td>
                        <td>{{=it.data[i].ProjectPlanID}}</td>
                        <td>{{=it.data[i].BordName}}</td>
                        <td>{{=it.data[i].ExistNum}}</td>
                        <td>{{=it.data[i].ExistNum}}</td>
                        <td>{{=it.data[i].ExistNum}}</td>
                        <td>{{=it.data[i].ExistNum}}</td>
                        <td>{{=it.data[i].ExistNum}}</td>
                        <td>{{=it.data[i].ExistNum}}</td>
                      </tr>

                {{ } }}

        {{ }else{ }}

                <h2>暂无数据</h2>

        {{ } }}

    </script>



    <script src="__PUBLIC__/Admin/doT-master/doT.js"></script>
    <script type="text/javascript">
        $(function(){
            var tmpl = document.getElementById('j-tmpl').innerHTML;
            console.log(tmpl);

            $('.add_row').click(function(){
                $('#sample-table-1 tbody').append(tmpl);

                layui.form().render();
                var num=1;
                $.each($('#sample-table-1 tbody tr .tr_row'), function(name, value) {
                  $(this).html("车型"+num);
                    num++;
                });
            });

            //smartMenu右键自定义上下文菜单插件初使化
            Fn_Init_smartMenu();

            $('.ui-state-default.ui-jqgrid-hdiv').click(function(){
                Fn_Init_smartMenu();
            });

            $('.ui-jqgrid-bdiv').click(function(){
                Fn_Init_smartMenu();
            });

        });
    </script>
    <!-- 模板引擎doT.js    end -->




    <!-- jQuery smartMenu右键自定义上下文菜单插件  start -->
    <script type="text/javascript" src="__PUBLIC__/Admin/jquery-smartMenu/js/jquery-smartMenu.js"></script>
    <script>
        function Fn_Init_smartMenu(){
            var chkSingle = $("th input"), chkGroup = $("td input");
            var funTrStyle = function() {
              chkGroup.each(function() {
                if ($(this).attr("checked")) {
                  $(this).parents("tr").addClass("bg");
                } else {
                  $(this).parents("tr").removeClass("bg");
                }
              });
            }, funTrGet = function() {
              return  $("td input:checked").parents("tr");
            };

            chkSingle.bind("click", function() {
              if ($(this).attr("checked")) {
                chkGroup.attr("checked", "checked");
              } else {
                chkGroup.attr("checked", "");
              }
              funTrStyle();
            });

            chkGroup.bind("click", funTrStyle);
            funTrStyle();

            //自定义右键上下文
            var objDelete = {
              text: "删除",
              func: function() {
                  $('#del_grid-table').trigger('click');
              }
            }, objShow = {
              text: "查看",
              func: function() {
                  $('#view_grid-table').trigger('click');
              }
            }, objEdit = {
              text: "编辑",
              func: function() {
                  $('#edit_grid-table').trigger('click');
              }
            }, objUnRead = {}, objSend = {};

            var mailMenuData = [
              [objDelete, objShow]
            ];

            $("#grid-table>tbody>tr").smartMenu(mailMenuData, {
              name: "mail",
              beforeShow: function() {
                //根据选中的是否是已读显示不同的上下文菜单
                $(this).find("input").attr("checked", "checked");
                funTrStyle();

                //动态数据，及时清除
                $.smartMenu.remove();

                //确定显示数据 - 主要是已读与未读
                var numTrBold = 0, numTrNormal = 0, eleTr = funTrGet();
                eleTr.each(function() {
                  if ($(this).css("font-weight") === "700") {
                    numTrBold++;
                  }
                  if ($(this).css("font-weight") === "400") {
                    numTrNormal++;
                  }
                });

                if (eleTr.size() === numTrBold) {
                  //全是粗体
                  mailMenuData[1] = [objEdit];
                } else if (eleTr.size() === numTrNormal) {
                  //全是正常
                  mailMenuData[1] = [objEdit];
                } else {
                  //混杂
                  mailMenuData[1] = [objEdit];
                }
              }
            });
        }
    </script>
    <!-- jQuery smartMenu右键自定义上下文菜单插件  end -->



    <!-- ============================= -->
    <!-- 确认弹框 start-->
    <div id="dialog-confirm" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">

            <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                <tbody id="liaoliao_box">
                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="来料计划编号" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="来料名称" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-2">
                          </div>
                        </div>
                      </div>
                      <div class="layui-inline" style="display:none;">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-3">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="数量" autocomplete="off" class="layui-input item-4">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <a href="javascript:;" class="layui-btn add_row">
                        <i class="layui-icon">&#xe608;</i> 添加
                      </a>
                    </td>
                  </tr>

                </tbody>
              </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 追溯 start-->
    <div id="dialog-confirm_bl_info" class="hide">
        <div class="row">
          <div class="col-xs-12">
            <div class="table-responsive">
                <form class="layui-form layui-form-pane col-xs-12" action="" id="dialog_search_form">
                    <table id="sample-table-1" class="table table-striped table-bordered table-hover">


                          <thead>
                            <tr>
                              <td colspan="9">
                                <div class="layui-inline">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">生产工单号</label>
                                    <div class="layui-input-inline">
                                      <input type="text" name="WorkOrderID" placeholder="全部" autocomplete="off" class="layui-input WorkOrderID">
                                    </div>
                                  </div>
                                </div>

                                <div class="layui-inline">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">零件名称</label>
                                    <div class="layui-input-inline">
                                      <select name="PartName" class="PartName" id="PartName">
                                        <option value="请选择">全部</option>
                                      </select>
                                    </div>
                                  </div>
                                </div>

                                <div class="layui-inline">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">模具名称</label>
                                    <div class="layui-input-inline">
                                      <select name="MouldName" class="MouldName" id="MouldName">
                                        <option value="请选择">全部</option>
                                      </select>
                                    </div>
                                  </div>
                                </div>

                                <div class="layui-inline">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">是否追溯</label>
                                    <div class="layui-input-inline">
                                      <select name="IsTrace" class="IsTrace">
                                        <option value="请选择">全部</option>
                                        <option value="1">是</option>
                                        <option value="0">否</option>
                                      </select>
                                    </div>
                                  </div>
                                </div>


                                <div class="layui-inline">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">板料批次号</label>
                                    <div class="layui-input-inline">
                                      <input type="text" name="ProjectPlanID" placeholder="" autocomplete="off" class="layui-input ProjectPlanID">
                                    </div>
                                  </div>
                                </div>

                                <div class="layui-inline">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">下线时间</label>
                                    <div class="layui-input-inline">
                                      <input class="layui-input Date1 LAY_demorange_s" name="Date1" value="{$_POST['Date1']}">
                                    </div>
                                    <div class="layui-input-inline">
                                      <input class="layui-input Date2 LAY_demorange_e" name="Date2" value="{$_POST['Date2']}">
                                    </div>
                                  </div>
                                </div>


                              </td>
                              <td style="text-align:right;">
                                <button class="layui-btn bl_keyword_btn" lay-submit="" lay-filter="demo1">搜索</button>
                              </td>
                            </tr>
                          </thead>

                          <thead id='pl_zs'>
                            <tr>
                              <td colspan="9" align="right">

                                <div class="layui-form-item">
                                  <div class="layui-inline">
                                      <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" name="Num1" autocomplete="off" class="layui-input Num1">
                                      </div>
                                      <div class="layui-form-mid">-</div>
                                      <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" name="Num2" autocomplete="off" class="layui-input Num2">
                                      </div>
                                  </div>
                                </div>

                              </td>
                              <td style="text-align:right;">
                                <a class="layui-btn" id="pl_zs_btn">追溯</a>
                              </td>
                            </tr>
                          </thead>

                          <thead id="pl_cx">
                            <tr>
                              <td colspan="9" align="right">
                                <div class="layui-form-item">
                                  <div class="layui-inline">
                                      <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" name="Num1" autocomplete="off" class="layui-input Num1">
                                      </div>
                                      <div class="layui-form-mid">-</div>
                                      <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" name="Num2" autocomplete="off" class="layui-input Num2">
                                      </div>
                                  </div>
                                </div>
                              </td>

                              <td style="text-align:right;">
                                <a class="layui-btn" id="pl_cx_btn">撤销</a>
                              </td>
                            </tr>
                          </thead>

                      <thead style="display:none;">
                        <tr>
                          <th class="center">
                              序号
                          </th>
                          <th>
                              <!-- <input type="checkbox" name="" value="" /> -->
                          </th>
                          <th>日期</th>
                          <th>线体</th>
                          <th>零件名称</th>
                          <th>零件编号</th>
                          <th>模具名称</th>
                          <th>模具编号</th>
                          <th>下线时间</th>
                          <th>生产工单</th>
                        </tr>
                      </thead>
                      <tfoot>
                        <tr>
                          <td colspan="10" style="text-align:right;">
                            <button class="layui-btn" lay-submit="" lay-filter="demo1">确定</button>
                          </td>
                        </tr>
                      </tfoot>

                    </table>

                </form>


            </div><!-- /.table-responsive -->
          </div><!-- /span -->

          <div class="col-xs-12">
              <div class="panel" id="grid-table-2_box">

              </div>
          </div>
        </div>
    </div><!-- #dialog-confirm -->


    <!-- 来料详情 start-->
    <div id="dialog-confirm_detail" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">

            <table id="sample-table-1-3" class="table table-striped table-bordered table-hover">
                <tbody id="liaoliao_box">
                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="来料计划编号" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="创建人" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="创建时间" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="来料名称" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="数量" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="checkbox" name="like[write]" title="入库完成">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="3" style="text-align:right;">
                      <button class="layui-btn" lay-submit="" lay-filter="demo1">确认</button>
                    </td>
                  </tr>
                </tbody>
              </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->


    <!-- 确认弹框 start-->
    <div id="dialog-confirm_status" class="hide">

          <form class="layui-form layui-form-pane col-xs-12" action="" id="panding_form">

              <table class="layui-table">
                <colgroup>
                  <col width="60%">
                  <col>
                </colgroup>

                <tbody>
                  <tr>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">板料名称</label>
                          <div class="layui-input-inline">

                          </div>
                          <div class="layui-input-inline">
                            <input type="text" readonly placeholder="板料名称" autocomplete="off" class="layui-input BordName">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">板料编号</label>
                          <div class="layui-input-inline">

                          </div>
                          <div class="layui-input-inline">
                            <input type="text" readonly placeholder="板料编号" autocomplete="off" class="layui-input BordNO">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">条码</label>
                          <div class="layui-input-inline">
                            <input type="text" lay-verify="required" placeholder="条码" autocomplete="off" class="layui-input Code" style="width: 352px;">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>

                    </td>
                  </tr>

                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">包装</label>
                            <div class="layui-input-inline">

                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKPackage" class="IsOKPackage" value="1" title="OK" reason="PackageReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKPackage" class="IsOKPackage" value="0" title="NOK" reason="PackageReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline PackageReason_box">
                              <input type="text" name="PackageReason" placeholder="原因" autocomplete="off" class="layui-input PackageReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">标签</label>
                            <div class="layui-input-inline">

                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKLabel" class="IsOKLabel" value="1" title="OK" reason="LabelReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKLabel" class="IsOKLabel" value="0" title="NOK" reason="LabelReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline LabelReason_box">
                              <input type="text" name="LabelReason" placeholder="原因" autocomplete="off" class="layui-input LabelReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">板料尺寸</label>
                            <div class="layui-input-inline">
                                <input type="text" lay-verify="required" placeholder="基本信息" autocomplete="off" class="layui-input B_Size">
                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKBoardSize" class="IsOKBoardSize" value="1" title="OK" reason="BoardReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKBoardSize" class="IsOKBoardSize" value="0" title="NOK" reason="BoardReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline BoardReason_box">
                              <input type="text" name="BoardReason" placeholder="原因" autocomplete="off" class="layui-input BoardReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">板料厚度</label>
                            <div class="layui-input-inline">
                                <input type="text" lay-verify="required" placeholder="基本信息" autocomplete="off" class="layui-input B_Thickness">
                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKBoardThickness" class="IsOKBoardThickness" value="1" title="OK" reason="BordThicknessReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKBoardThickness" class="IsOKBoardThickness" value="0" title="NOK" reason="BordThicknessReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline BordThicknessReason_box">
                              <input type="text" name="BordThicknessReason" placeholder="原因" autocomplete="off" class="layui-input BordThicknessReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label width_175">板料在拖盘上的位置</label>
                            <div class="layui-input-inline width_140">
                                <img src="" width="100px;" class="B_Picture">
                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKBoardLocation" class="IsOKBoardLocation" value="1" title="OK" reason="BoardLocationReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKBoardLocation" class="IsOKBoardLocation" value="0" title="NOK" reason="BoardLocationReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline BoardLocationReason_box">
                              <input type="text" name="BoardLocationReason" placeholder="原因" autocomplete="off" class="layui-input BoardLocationReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">表面质量</label>
                            <div class="layui-input-inline">

                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKSurfaceQuality" class="IsOKSurfaceQuality" value="1" title="OK" reason="SurfaceQualityReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKSurfaceQuality" class="IsOKSurfaceQuality" value="0" title="NOK" reason="SurfaceQualityReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline SurfaceQualityReason_box">
                              <input type="text" name="SurfaceQualityReason" placeholder="原因" autocomplete="off" class="layui-input SurfaceQualityReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">毛刺</label>
                            <div class="layui-input-inline">

                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKGlitch" class="IsOKGlitch" value="1" title="OK" reason="GlitchReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKGlitch" class="IsOKGlitch" value="0" title="NOK" reason="GlitchReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline GlitchReason_box">
                              <input type="text" name="GlitchReason" placeholder="原因" autocomplete="off" class="layui-input GlitchReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label width_175">料剁高度（含拖盘）</label>
                            <div class="layui-input-inline width_140">

                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKBoardsHeight" class="IsOKBoardsHeight" value="1" title="OK" reason="BoardsHeightReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKBoardsHeight" class="IsOKBoardsHeight" value="0" title="NOK" reason="BoardsHeightReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline BoardsHeightReason_box">
                              <input type="text" name="BoardsHeightReason" placeholder="原因" autocomplete="off" class="layui-input BoardsHeightReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">料剁偏移</label>
                            <div class="layui-input-inline">
                                <img src="" width="100px;" class="P_Picture">
                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKBoardsOffset" class="IsOKBoardsOffset" value="1" title="OK" reason="BoardsOffsetReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKBoardsOffset" class="IsOKBoardsOffset" value="0" title="NOK" reason="BoardsOffsetReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline BoardsOffsetReason_box">
                              <input type="text" name="BoardsOffsetReason" placeholder="原因" autocomplete="off" class="layui-input BoardsOffsetReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">料剁平整</label>
                            <div class="layui-input-inline">

                            </div>
                            <div class="layui-input-inline" style="float: right;">
                                <input type="radio" name="IsOKBoardsSmooth" class="IsOKBoardsSmooth" value="1" title="OK" reason="BoardsSmoothReason" lay-filter="OK_Radio">
                                <input type="radio" name="IsOKBoardsSmooth" class="IsOKBoardsSmooth" value="0" title="NOK" reason="BoardsSmoothReason" lay-filter="OK_Radio">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">原因</label>
                            <div class="layui-input-inline BoardsSmoothReason_box">
                              <input type="text" name="BoardsSmoothReason" placeholder="原因" autocomplete="off" class="layui-input BoardsSmoothReason">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">登记人</label>
                            <div class="layui-input-inline">
                                <input type="text" lay-verify="required" readonly placeholder="记录人" autocomplete="off" class="layui-input StoragePeople">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">

                    </td>
                  </tr>

                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">检查结果</label>
                            <div class="layui-input-inline CheckFlag_box" style="width: 345px;">
                                <input type="radio" name="CheckFlag" lay-filter="CheckFlag_F" class="CheckFlag" value="合格" title="合格" checked="">
                                <input type="radio" name="CheckFlag" lay-filter="CheckFlag_F" class="CheckFlag" value="不合格" title="不合格">
                                <input type="radio" name="CheckFlag" lay-filter="CheckFlag_F" class="CheckFlag" value="待判定" title="待判定">
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">

                    </td>
                  </tr>
                  <tr>
                    <td class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">检查描述</label>
                            <div class="layui-input-inline" style="width: 345px;">
                                <textarea placeholder="请输入内容" name="CheckDescribe" class="layui-textarea CheckDescribe"></textarea>
                            </div>
                          </div>
                        </div>
                    </td>
                    <td class="left">
                        <input type="hidden" name="Num" class="Num">
                        <input type="hidden" name="ProjectDetailID" class="ProjectDetailID">
                        <button style="float:right;" class="layui-btn demo1_change_status" lay-submit="" lay-filter="demo1_change_status">确定</button>
                    </td>
                  </tr>
                </tbody>
              </table>

          </form>

    </div><!-- #dialog-confirm -->


    <script type="text/javascript">
        $(function(){
            //搜索板料名称渲染
            _ajax_bl_name_list('');

            //搜索板料编号渲染
            _ajax_lj_name_list('');

            $('body').on('click','div[aria-describedby=dialog-confirm_status] button',function(){
                window.location.reload();
            });

            //添加
            $( "#id-btn-dialog2" ).on('click', function(e) {
              e.preventDefault();

              $( "#dialog-confirm" ).removeClass('hide').dialog({
                resizable: false,
                modal: true,
                title: "",
                width:800,
                height:500,
                title_html: true,
                buttons: [
                  {
                    html: "<i class='icon-trash bigger-110'></i>&nbsp; 确定",
                    "class" : "btn btn-danger btn-xs",
                    click: function() {
                      $( this ).dialog( "close" );
                      window.location.href="{:U('Admin/Index/repair_list')}";
                    }
                  }
                  ,
                  {
                    html: "<i class='icon-remove bigger-110'></i>&nbsp; 取消",
                    "class" : "btn btn-xs",
                    click: function() {
                      $( this ).dialog( "close" );
                    }
                  }
                ]
              });

              $("div[aria-describedby='dialog-confirm'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 创建来料计划：</h4></div>");
            });

            //追溯：
            $( "body" ).on('click', '.id-btn-dialog2_bl_info', function(e) {
              e.preventDefault();
              //标识当前项
              $('#liaoliao_box tr').removeClass('cur_active');
              $(this).parents('tr').addClass('cur_active');

              _ajax_mould_list();
              _ajax_lingjian_list();

              $( "#dialog-confirm_bl_info" ).removeClass('hide').dialog({
                resizable: false,
                modal: true,
                title: "",
                width:1200,
                title_html: true
              });

              $("div[aria-describedby='dialog-confirm_bl_info'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 追溯：</h4></div>");

              $('.bl_keyword_btn').trigger('click');
            });

            //批量追溯
            $('body').on('click','#pl_zs_btn',function(){
                var table_1_id = $('#grid-table').jqGrid('getGridParam', 'selrow');
                var table_1_rowData = $('#grid-table').jqGrid('getRowData',table_1_id);
                　　

                console.log(table_1_rowData);
                var Num1=$('#pl_zs .Num1').val();
                var Num2=$('#pl_zs .Num2').val();
                var ProjectDetailID=table_1_rowData.ProjectDetailID;
                var ProjectFloodID=table_1_rowData.ID;


               console.log(Num1);
               console.log(Num2);
               console.log(ProjectDetailID);



                _ajax_pl_zs(Num1, Num2, ProjectDetailID, ProjectFloodID);
            });

            //批量撤销
            $('body').on('click','#pl_cx_btn',function(){　　
                var Num1=$('#pl_cx .Num1').val();
                var Num2=$('#pl_cx .Num2').val();

                console.log(Num1);
                console.log(Num2);

                _ajax_pl_cx(Num1, Num2);
            });


            //选择板料信息行
            $('body').on('click','#_bl_list tr',function(){　　
                var B_Name=$(this).attr('data-B_Name');
                var B_Number=$(this).attr('data-B_Number');

                $('.cur_active .item-2').val(B_Name);
                $('.cur_active .item-3').val(B_Number);

                layui.form().render();

                $("div[aria-describedby='dialog-confirm_bl_info'] .auto_close").trigger("click");
            });

            //来料详情
            $( ".id-btn-dialog2_detail" ).on('click', function(e) {
              e.preventDefault();

              $( "#dialog-confirm_detail" ).removeClass('hide').dialog({
                resizable: false,
                modal: true,
                title: "",
                width:800,
                title_html: true,
              });

              $("div[aria-describedby='dialog-confirm_detail'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 来料详情：</h4></div>");
            });

            //状态
            $( "body" ).on('click', '.id-btn-dialog2_status', function(e) {
              e.preventDefault();

              var _id = $('#grid-table').jqGrid('getGridParam', 'selrow');
              var _rowData = $('#grid-table').jqGrid('getRowData',_id);
              console.log(_rowData);

              $('#panding_form .ProjectDetailID').val(_rowData.ProjectDetailID);
              $('#panding_form .CheckFlag[value='+$(_rowData.CheckFlag).html()+']').attr('checked',true);
              $('#panding_form .Num').val(_rowData.Number);


              $('#panding_form .BordName').val(_rowData.BordName);
              $('#panding_form .BordNO').val(_rowData.BordNO);
              $('#panding_form .StoragePeople').val(_rowData.StoragePeople);


              //获取信息
              var _json=_ajax_get_panding_info(_rowData.ProjectDetailID);
              console.log(_json);


              $('#panding_form .Code').val(_json.Code);
              $('#panding_form .B_Size').val(_json.B_Size);
              $('#panding_form .B_Thickness').val(_json.B_Thickness);
              $('#panding_form .B_Picture').attr('src', _json.B_Picture);
              $('#panding_form .P_Picture').attr('src', _json.P_Picture);


              var Obj_json=[
                  {'name_1':'IsOKPackage', 'name_2':'PackageReason', 'value_1':_json.IsOKPackage, 'value_2':_json.PackageReason},
                  {'name_1':'IsOKLabel', 'name_2':'LabelReason', 'value_1':_json.IsOKLabel, 'value_2':_json.LabelReason},
                  {'name_1':'IsOKBoardSize', 'name_2':'BoardReason', 'value_1':_json.IsOKBoardSize, 'value_2':_json.BoardReason},
                  {'name_1':'IsOKBoardThickness', 'name_2':'BordThicknessReason', 'value_1':_json.IsOKBoardThickness, 'value_2':_json.BordThicknessReason},
                  {'name_1':'IsOKBoardLocation', 'name_2':'BoardLocationReason', 'value_1':_json.IsOKBoardLocation, 'value_2':_json.BoardLocationReason},
                  {'name_1':'IsOKSurfaceQuality', 'name_2':'SurfaceQualityReason', 'value_1':_json.IsOKSurfaceQuality, 'value_2':_json.SurfaceQualityReason},
                  {'name_1':'IsOKGlitch', 'name_2':'GlitchReason', 'value_1':_json.IsOKGlitch, 'value_2':_json.GlitchReason},
                  {'name_1':'IsOKBoardsHeight', 'name_2':'BoardsHeightReason', 'value_1':_json.IsOKBoardsHeight, 'value_2':_json.BoardsHeightReason},
                  {'name_1':'IsOKBoardsOffset', 'name_2':'BoardsOffsetReason', 'value_1':_json.IsOKBoardsOffset, 'value_2':_json.BoardsOffsetReason},
                  {'name_1':'IsOKBoardsSmooth', 'name_2':'BoardsSmoothReason', 'value_1':_json.IsOKBoardsSmooth, 'value_2':_json.BoardsSmoothReason}
              ];

              console.log(Obj_json);

              var num=1;
              for (var i = 0; i < Obj_json.length; i++) {
                    var name_1=Obj_json[i].name_1;
                    var name_2=Obj_json[i].name_2;
                    var value_1=Obj_json[i].value_1;
                    var value_2=Obj_json[i].value_2;

                    $('#panding_form .'+name_1).attr('reason_val', value_2);
                    $('#panding_form .'+name_1+'[value='+value_1+']').attr('checked',true)
                    $('#panding_form .'+name_2).val(value_2);
                    if(!value_1){
                        $('#panding_form .'+name_2).attr('lay-verify', "required");
                    }else{
                        $('#panding_form .'+name_2).removeAttr('lay-verify');
                    }

                    $('#panding_form .demo1_change_status').attr(name_1, value_1);
                    num*=value_1;
              }

              if(_json.CheckFlag=='合格'){
                    var str='<input type="radio" name="CheckFlag" class="CheckFlag" value="合格" title="合格" checked>'
                           +'<input type="radio" name="CheckFlag" class="CheckFlag" value="不合格" title="不合格" disabled>'
                           +'<input type="radio" name="CheckFlag" class="CheckFlag" value="待判定" title="待判定" disabled>';
              }
              if(_json.CheckFlag=='不合格'){
                    var str='<input type="radio" name="CheckFlag" class="CheckFlag" value="合格" title="合格" disabled>'
                           +'<input type="radio" name="CheckFlag" class="CheckFlag" value="不合格" title="不合格" checked>'
                           +'<input type="radio" name="CheckFlag" class="CheckFlag" value="待判定" title="待判定" disabled>';
              }
              if(_json.CheckFlag=='待判定'){
                    var str='<input type="radio" name="CheckFlag" class="CheckFlag" value="合格" title="合格" disabled>'
                           +'<input type="radio" name="CheckFlag" class="CheckFlag" value="不合格" title="不合格" disabled>'
                           +'<input type="radio" name="CheckFlag" class="CheckFlag" value="待判定" title="待判定" checked>';
              }
              if(_json.CheckFlag=='已删除'){
                    var str='<input type="radio" name="CheckFlag" class="CheckFlag" value="合格" title="合格" disabled>'
                           +'<input type="radio" name="CheckFlag" class="CheckFlag" value="不合格" title="不合格" disabled>'
                           +'<input type="radio" name="CheckFlag" class="CheckFlag" value="待判定" title="待判定" checked>'
                           +'<input type="radio" name="CheckFlag" class="CheckFlag" value="已删除" title="已删除" checked>';
              }
              $('#panding_form .CheckFlag_box').html(str);
              $('#panding_form .CheckDescribe').val(_json.CheckDescribe);

              layui.form().render();

              $( "#dialog-confirm_status" ).removeClass('hide').dialog({
                resizable: false,
                modal: true,
                title: "",
                height:800,
                width:1000,
                title_html: true,
              });

              $("div[aria-describedby='dialog-confirm_status'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 判定：</h4></div>");
            });
        });
    </script>
    <!-- 确认弹框 end-->



    <script type="text/javascript">
      jQuery.support.cors=true;

       function init_grid_table_2(grid_data){
            $('#grid-table-2_box').html('<table id="grid-table-2"></table><div id="grid-pager-2"></div>');

            $('#grid-table-2').jqGrid({
              data: grid_data,
              datatype: "local",
              height: 430,
              width:1160,
              colNames:['ID', '日期','线体','零件名称','零件编号','模具名称','模具编号','下线时间','生产工单','是否追溯','追溯时间','板料批次号','操作'],
              colModel:[
                {name:'ID',index:'ID',  sorttype:"int",align : "center"},

                {name:'Date',index:'Date',align : "center"},
                {name:'Line',index:'Line',align : "center"},
                {name:'PartName',index:'PartName',align : "center"},
                {name:'PartNumber',index:'PartNumber',align : "center"},
                {name:'MouldName',index:'MouldName', align : "center"},
                {name:'MouldNumber',index:'MouldNumber',align : "center"},
                {name:'OffLineTime',index:'OffLineTime', align : "center"},
                {name:'WorkOrderID',index:'WorkOrderID', align : "center"},
                {name:'IsTrace',index:'IsTrace', align : "center"},
                {name:'TraceTime',index:'TraceTime', align : "center"},
                {name:'ProjectPlanID',index:'ProjectPlanID', align : "center"},

                {name:'options',index:'options',align:'center',hidden:true}
              ],
              rownumbers:true,
              rownumWidth:50,//设置行号列宽度
              autowidth:false,
              shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
              viewrecords : true,
              rowNum:10,
              rowList:[10,20,30],
              pager : '#grid-pager-2',
              altRows: true,
              multiselect: true,
              multiboxonly: true,

              loadComplete : function() {
                var table = this;
                setTimeout(function(){
                  updatePagerIcons(table);
                }, 0);
              },


              gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
                  var ids=jQuery(grid_selector).jqGrid('getDataIDs');
                  for(var i=0; i<ids.length; i++){
                      var id=ids[i];

                      var options="";
                      options += "<button class='btn btn-primary btn-xs id-btn-dialog2_bl_info' style='margin-right:5px;'><i class='icon-edit bigger-110'></i>追溯</button>";
                      options += "<button class='btn btn-danger btn-xs row_del'><i class='icon-trash bigger-110'></i>撤销</button>";
                      jQuery(grid_selector).jqGrid('setRowData', ids[i], { options: options });
                  }
              }
            });
       }

       //replace icons with FontAwesome icons like above   //更新分页图标
       function updatePagerIcons(table) {
         var replacement =
         {
           'ui-icon-seek-first' : 'icon-double-angle-left bigger-140',
           'ui-icon-seek-prev' : 'icon-angle-left bigger-140',
           'ui-icon-seek-next' : 'icon-angle-right bigger-140',
           'ui-icon-seek-end' : 'icon-double-angle-right bigger-140'
         };
         $('.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon').each(function(){
           var icon = $(this);
           var $class = $.trim(icon.attr('class').replace('ui-icon', ''));

           if($class in replacement) icon.attr('class', 'ui-icon '+replacement[$class]);
         })
       }

       //初使化来料列表
       function get_bl_list(data){　　
           var data=data.field;

           $.ajax({
               async:false,
               type:'get',
               contentType:"application/x-www-form-urlencoded",
               url : 'http://'+api_url+'/Default.ashx?TaskID=41921',
               data: data,
               dataType : 'json',
               success  : function(json) {
                   if(json.code == 0){

                    console.log(json.data);
                       // var tmpl = document.getElementById('j-tmpl-bl-list').innerHTML;
                       // var doTtmpl = doT.template(tmpl);
                       // var doT_Str=doTtmpl(json);
                       // $('#_bl_list').html(doT_Str);

                       init_grid_table_2(json.data);

                       layui.form().render();
                   }else{
                       alert(json.msg);
                   }
               },
               error  : function() {
                   alert('接口错误');
               }
           });

           //添加一行
           $('.add_row').click(function(){
               $('#sample-table-1 tbody').append(tmpl);

               var num=1;
               $.each($('#sample-table-1 tbody tr .tr_row'), function(name, value) {
                 $(this).html("车型"+num);
                   num++;
               });
           });
       }

       //获取判定相关信息
       function _ajax_get_panding_info(ProjectDetailID){　　
           var row_data;
           $.ajax({
               async:false,
               type:'get',
               contentType:"application/x-www-form-urlencoded",
               url : 'http://'+api_url+'/Default.ashx?TaskID=4210',
               data: {'ProjectDetailID':ProjectDetailID},
               dataType : 'json',
               success  : function(json) {
                   if(json.code == 0){
                       row_data=json.data;
                   }else{
                       alert(json.msg);
                   }
               },
               error  : function() {
                   alert('error');
               }
           });

           return row_data;
       }


       //获取板料名称列表
       function _ajax_bl_name_list(B_Name){
           $.ajax({
               async:false,
               type:'post',
               url : 'http://'+api_url+'/Default.ashx?TaskID=40040',
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       var str="<option value='请选择'>全部</option>";
                       $.each(json.data, function(name, value) {
                           if(B_Name==value){
                               str+="<option value='"+value+"' selected>"+value+"</option>";
                           }else{
                               str+="<option value='"+value+"'>"+value+"</option>";
                           }
                       });
                       $('#bl_name_select').html(str);
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }

       //获取板料编号列表
       function _ajax_lj_name_list(B_Number){
           $.ajax({
               async:false,
               type:'post',
               url : 'http://'+api_url+'/Default.ashx?TaskID=40932',
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       var str="<option value='请选择'>全部</option>";
                       $.each(json.data, function(name, value) {
                           if(B_Number==value){
                               str+="<option value='"+value+"' selected>"+value+"</option>";
                           }else{
                               str+="<option value='"+value+"'>"+value+"</option>";
                           }
                       });
                       $('#PartNumber_select').html(str);
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }

       //获取板料名称列表
       function _ajax_bl_name_list(B_Number){
           $.ajax({
               async:false,
               type:'post',
               url : 'http://'+api_url+'/Default.ashx?TaskID=3001',
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       var str="<option value='请选择'>全部</option>";
                       $.each(json.data, function(name, value) {
                           if(B_Number==value.B_Number){
                               str+="<option value='"+value.B_Name+"' selected>"+value.B_Name+"</option>";
                           }else{
                               str+="<option value='"+value.B_Name+"'>"+value.B_Name+"</option>";
                           }
                       });
                       $('#form_search_0 .B_Name_select_box>div').remove();
                       $('#form_search_0 .B_Number_select_box>div').remove();
                       $('#form_search_0 .B_Name_select').html(str);
                       layui.form().render();
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }

       //获取板料编号列表
       function _ajax_bl_number_list(B_Name){
           $.ajax({
               async:false,
               type:'post',
               url : 'http://'+api_url+'/Default.ashx?TaskID=3001',
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       var str="<option value='请选择'>全部</option>";
                       $.each(json.data, function(name, value) {
                           if(B_Name==value.B_Name){
                               str+="<option value='"+value.B_Number+"' selected>"+value.B_Number+"</option>";
                           }else{
                               str+="<option value='"+value.B_Number+"'>"+value.B_Number+"</option>";
                           }
                       });
                       $('#form_search_0 .B_Name_select_box>div').remove();
                       $('#form_search_0 .B_Number_select_box>div').remove();
                       $('#form_search_0 .B_Number_select').html(str);
                       layui.form().render();
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }

       //获取板料名称列表
       function _ajax_bl_name_list_2(B_Number){
           $.ajax({
               async:false,
               type:'post',
               url : 'http://'+api_url+'/Default.ashx?TaskID=3001',
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       var str="<option value='请选择'>全部</option>";
                       $.each(json.data, function(name, value) {
                           if(B_Number==value.B_Number){
                               str+="<option value='"+value.B_Name+"' selected>"+value.B_Name+"</option>";
                           }else{
                               str+="<option value='"+value.B_Name+"'>"+value.B_Name+"</option>";
                           }
                       });
                       $('#form_search .B_Name_select_box_2>div').remove();
                       $('#form_search .B_Number_select_box_2>div').remove();
                       $('#form_search .B_Name_select').html(str);
                       layui.form().render();
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }

       //获取板料编号列表
       function _ajax_bl_number_list_2(B_Name){
           $.ajax({
               async:false,
               type:'post',
               url : 'http://'+api_url+'/Default.ashx?TaskID=3001',
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       var str="<option value='请选择'>全部</option>";
                       $.each(json.data, function(name, value) {
                           if(B_Name==value.B_Name){
                               str+="<option value='"+value.B_Number+"' selected>"+value.B_Number+"</option>";
                           }else{
                               str+="<option value='"+value.B_Number+"'>"+value.B_Number+"</option>";
                           }
                       });
                       $('#form_search .B_Name_select_box_2>div').remove();
                       $('#form_search .B_Number_select_box_2>div').remove();
                       $('#form_search .B_Number_select').html(str);
                       layui.form().render();
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }

       function _ajax_Usefor_list_2(Usefor){
           $.each($('#search_table .Usefor option'), function(name, value){
               if($(this).attr('value')==Usefor){
                   $(this).attr('selected','selected');
               }else{
                   $(this).removeAttr('selected');
               }
           });
           layui.form().render();
       }

       //获取零件名称列表
       function _ajax_mould_list(){
           $.ajax({
               async:false,
               type:'post',
               url : 'http://'+api_url+'/Default.ashx?TaskID=2011',
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       var str="<option value='请选择'>全部</option>";
                       $.each(json.data, function(name, value) {
                           str+="<option value='"+value.M_Name+"'>"+value.M_Name+"</option>";
                       });
                       $('#dialog_search_form select.MouldName').html(str);

                       // layui.form().render();
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }

       //获取零件名称列表
       function _ajax_lingjian_list(){
           $.ajax({
               async:false,
               type:'post',
               url : 'http://'+api_url+'/Default.ashx?TaskID=3021',
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       var str="<option value='请选择'>全部</option>";
                       $.each(json.data, function(name, value) {
                            str+="<option value='"+value.P_Name+"'>"+value.P_Name+"</option>";
                       });
                       $('#dialog_search_form  select.PartName').html(str);

                       // layui.form().render();
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }


       function _ajax_pl_zs(Num1, Num2, ProjectDetailID, ProjectFloodID){
           $.ajax({
               async:false,
               type:'get',
               url : 'http://'+api_url+'/Default.ashx?TaskID=41922',
               data:{
                  Num1:Num1,
                  Num2:Num2,
                  ProjectDetailID:ProjectDetailID,
                  ProjectFloodID:ProjectFloodID
               },
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       layer.msg(json.msg);
                       $('.bl_keyword_btn').trigger('click');
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }

       function _ajax_pl_cx(Num1, Num2, ProjectDetailID){
           $.ajax({
               async:false,
               type:'get',
               url : 'http://'+api_url+'/Default.ashx?TaskID=41923',
               data:{
                  Num1:Num1,
                  Num2:Num2
               },
               dataType : 'json',
               success  : function(json) {
                   if(json.code==0){
                       layer.msg(json.msg);
                       $('.bl_keyword_btn').trigger('click');
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function(json) {
                   layer.msg(json.msg);
               }
           });
       }


    </script>



    <script type="text/javascript">
        $(function(){
            //初使化按钮操作权限
            var page="{$page}";
            _init_button_operate(page);

            setTimeout(function(){
                $('.demo1_search_0').trigger('click');
                $('.demo1_search').trigger('click');
            },1000);

            //导出问题列表
            $('#export_list').click(function(){
                var BordName=$('#search_table .BordName').val();
                var PartNumber=$('#search_table .PartNumber').val();
                var ProjectPlanID=$('#search_table .ProjectPlanID').val();
                var Date1=$('#search_table .Date1').val();
                var Date2=$('#search_table .Date2').val();
                var Status=$('#search_table .Status').val();
                var Cailiaofactory=$('#search_table .Cailiaofactory').val();

                _ajax_export_list(BordName, PartNumber, ProjectPlanID, Date1, Date2, Status, Cailiaofactory);
            });
        });

        function _ajax_export_list(BordName, PartNumber, ProjectPlanID, Date1, Date2, Status, Cailiaofactory){
            $.ajax({
                async:false,
                type:'get',
                contentType:"application/x-www-form-urlencoded",
                url : 'http://'+api_url+'/Default.ashx?TaskID=41991',
                data: {
                          'BordName':BordName,
                          'PartNumber':PartNumber,
                          'ProjectPlanID':ProjectPlanID,
                          'Date1':Date1,
                          'Date2':Date2,
                          'Status':Status,
                          'Cailiaofactory':Cailiaofactory
                      },
                dataType : 'json',
                success  : function(json) {
                    if(json.code==0){
                        var download_url='http://'+api_url+'/'+json.data;
                        // console.log(download_url);return;

                        window.location.href=download_url;
                    }else{
                        layer.msg(json.msg);
                    }
                },
                error  : function(json) {
                    layer.msg(json.msg);
                }
            });
        }

        //获取图表数据
        function _ajax_get_echartData(data){
            var _json;
            $.ajax({
                async:false,
                type:'get',
                contentType:"application/x-www-form-urlencoded",
                url : 'http://'+api_url+'/Default.ashx?TaskID=4091',
                data: data,
                dataType : 'json',
                success  : function(json) {
                    if(json.code==0){
                        _json=json.data;
                    }else{
                        _json=json.data;
                    }
                },
                error  : function(json) {
                    layer.msg(json.msg);
                }
            });
            return _json;
        }
    </script>

    <script src="__ROOT__/echart/echarts.min.js"></script>
    <script type="text/javascript">
        $(function(){
            _ajax_bl_name_list('');//板料名称
            _ajax_bl_number_list('');//板料编号

            setTimeout(function(){
                $('.demo1_search_0').trigger('click');
            },1500);
        });

        function render_echart_pie(_ajax_data){
          var echart_data_1=[];
          var echart_data_2=[];
          var echart_data_3=[];

          var people_data=[];
          var total_data=[];
          $.each(_ajax_data, function(name, value) {
              people_data.push(value.B_Name);
              total_data.push(value.YearUseNUm);
          });

          var tag_data=['UnqualifiedNum', 'BaofeiNum', 'ConsumNum'];

          for (var i = 0; i < tag_data.length; i++) {

              $.each(_ajax_data, function(name, value) {
                  if(tag_data[i]=='UnqualifiedNum'){
                      echart_data_1.push(value.UnqualifiedNum);
                  }
                  if(tag_data[i]=='BaofeiNum'){
                      echart_data_2.push(value.BaofeiNum);
                  }
                  if(tag_data[i]=='ConsumNum'){
                      echart_data_3.push(value.ConsumNum);
                  }
              });

          }

          var ___temp__="[";
          for (var i = 0; i < people_data.length; i++) {
              if(i==people_data.length-1){
                ___temp__+="{'name' : '合计', 'value' : "+total_data[i]+", 'xAxis': "+i+", 'yAxis': "+total_data[i]+"}";
              }else{
                ___temp__+="{'name' : '合计', 'value' : "+total_data[i]+", 'xAxis': "+i+", 'yAxis': "+total_data[i]+"},";
              }
          }
          ___temp__+="]";


          ___temp__ = eval('('+___temp__+')');
          // 基于准备好的dom，初始化echarts图表
          var myChart = echarts.init(document.getElementById('echart_pie'));

          var option = {
             tooltip : {
                 trigger: 'axis',
                 axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                     type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                 }
             },
             legend: {
                 data:['不合格数量','报废数量','已消耗数量']
             },
             grid: {
                 left: '3%',
                 right: '4%',
                 bottom: '3%',
                 containLabel: true
             },
             xAxis : [
                 {
                     type : 'category',
                     data : people_data
                 },
             ],
             yAxis : [
                 {
                     type : 'value'
                 }
             ],
             series : [
                 {
                     name:'不合格数量',
                     type:'bar',
                     stack: '时间',
                      label: {
                         normal: {
                             show: true,
                             position: 'inside'
                         }
                     },
                     data:echart_data_1
                 },
                 {
                     name:'报废数量',
                     type:'bar',
                     stack: '时间',
                      label: {
                         normal: {
                             show: true,
                             position: 'inside'
                         }
                     },
                     data:echart_data_2
                 },
                 {
                     name:'已消耗数量',
                     type:'bar',
                     stack: '时间',
                      label: {
                         normal: {
                             show: true,
                             position: 'inside'
                         }
                     },
                     data:echart_data_3
                 },
                  {
                     name:'总计',
                     type:'line',
                     stack: '总计',
                     markPoint : {
                         data : ___temp__
                     },
                     data:total_data
                 }

             ]
         };

          // 为echarts对象加载数据
          myChart.setOption(option);
          window.onresize = myChart.resize;
        }
    </script>

    <script type="text/javascript">

            layui.use(['form', 'laydate'], function(){
              var form = layui.form()
              ,layer = layui.layer
              ,laydate = layui.laydate;

              var start = {
                format: 'YYYY-MM-DD hh:mm:ss'
                ,istoday: false
                ,istime: true
              };

              $('.date_time').click(function(){
                  start.elem = this;
                  laydate(start);
              })

              //监听提交
              form.on('submit(demo1_search_0)', function(data){
                var _ajax_data=_ajax_get_echartData(data.field);
                render_gridTable_0(_ajax_data);
                render_echart_pie(_ajax_data);
                return false;
              });

              //监听提交
              form.on('submit(demo1_search)', function(data){
                data.field.Usefor=$('#form_search_0 .Usefor').val();
                _ajax_list_gridTable(data.field);
                return false;
              });

              //监听提交
              form.on('submit(demo1)', function(data){
                get_bl_list(data);
                return false;
              });

              //监听提交
              form.on('select(B_Name_select)', function(data){
                _ajax_bl_number_list(data.value);
                return false;
              });

              //监听提交
              form.on('select(B_Number_select)', function(data){
                _ajax_bl_name_list(data.value);
                return false;
              });

              //监听提交
              form.on('select(B_Name_select_2)', function(data){
                _ajax_bl_number_list_2(data.value);
                return false;
              });

              //监听提交
              form.on('select(B_Number_select_2)', function(data){
                _ajax_bl_name_list_2(data.value);
                return false;
              });
            });


    </script>
  </body>
</html>
