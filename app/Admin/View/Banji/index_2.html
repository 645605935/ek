<include file="Public/header"/>
    <!-- basic styles -->
    <link href="__PUBLIC__/Admin/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome.min.css" />

    <!--[if IE 7]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome-ie7.min.css" />
    <![endif]-->

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.custom.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/chosen.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/bootstrap-timepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/daterangepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/colorpicker.css" />

    <!-- 模块jqgrid  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.full.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ui.jqgrid.css" />
    <!-- 模块jqgrid  end -->

    <!-- fonts -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/assets/css/google_font_css.css">

    <!-- ace styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-rtl.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-skins.min.css" />

    <!-- jQuery smartMenu右键自定义上下文菜单插件  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/jquery-smartMenu/css/smartMenu.css" type="text/css" />
    <!-- jQuery smartMenu右键自定义上下文菜单插件  end -->

    <link rel="stylesheet" href="__PUBLIC__/Admin/layui-v1.0.4/layui/css/layui.css"  media="all">
    <link rel="stylesheet" href="__PUBLIC__/Admin/css/my_diy_css.css"  media="all">

    <style type="text/css">
        #createtable{padding: 32px;}
        .width_175{
            width: 175px!important;
        }

        .width_140{
            width: 140px!important;
        }

    </style>

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-ie.min.css" />
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->

    <script src="__PUBLIC__/Admin/assets/js/ace-extra.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.min.js"></script>
    <!-- layui.js   -->
    <script src="__PUBLIC__/Admin/layui-v1.0.4/layui/layui.js"></script>
    <script src="__PUBLIC__/layer/layer.js"></script>
<script>



</script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->



    <!--[if lt IE 9]>

    <script src="__PUBLIC__/Admin/assets/js/html5shiv.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/respond.min.js"></script>

    <![endif]-->

  </head>

  <body>
    <div class="navbar navbar-default" id="navbar">
      <include file="Public/navbar"/>
    </div>

    <div class="main-container" id="main-container">

      <script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
      </script>

      <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
          <span class="menu-text"></span>
        </a>

        <!-- 左侧菜单栏 start-->
        <div class="sidebar" id="sidebar">
          <include file="Public/left"/>
        </div>

        <!-- 右侧主要内容 start-->
        <div class="main-content" style="overflow: hidden;">


          <!-- 右block_1  start -->
          <div class="breadcrumbs" id="breadcrumbs">
            <script type="text/javascript">
              try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
            </script>

            <ul class="breadcrumb">
              <include file="Public/_breadcrumb"/>
            </ul><!-- .breadcrumb -->

            <div class="nav-search" id="nav-search">
              <form class="form-search">
                <span class="input-icon">
                  <input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
                  <i class="icon-search nav-search-icon"></i>
                </span>
              </form>
            </div><!-- #nav-search -->
          </div>
          <!-- 右block_1  end -->

          <div class="page-content">

            <div class="row">
                <style>
                  .layui-form-item .layui-input-inline{width: auto!important;}
                  .layui-form-item{margin-bottom: 0px;}
                  .search_button{position: absolute!important;right: 0px!important;top: 4px!important;}
                  #gbox_grid-table{width: 100%!important;}
                  #gview_grid-table{width: 100%!important;}
                  #gview_grid-table>div{width: 100%!important;}
                  #trv_Modify,#trv_Delete{display: none;}


                  #left_errors_box tr .error_name{
                      background: url('__PUBLIC__/Admin/images/error/dent.png') no-repeat 17px 10px;background-size: 33px;padding-left: 55px;
                  }
                  input[readonly]{color: #9C9292!important;}
                </style>

                <!-- 权限设置  start -->
                <div class="row">
                  <include file="Public/role_page_setting"/>
                </div>
                <!-- 权限设置  end -->

                <!-- 搜索  start -->
                <div class="row">
                  <div class="col-xs-12">

                    <form class="layui-form layui-form-pane col-xs-12" action="" method="post">
                       <table class="layui-table" id="search_table">
                          <thead>
                            <tr>
                              <th>搜索</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>

                                <div class="layui-inline" style="margin-top: 5px;">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">生产工单号</label>
                                    <div class="layui-input-inline">
                                      <input type="text" name="orderid" placeholder="全部" value="{$_POST['ProductWorkOrderID']}" autocomplete="off" class="layui-input ProductWorkOrderID">
                                    </div>
                                  </div>
                                </div>

                                <div class="layui-inline" style="margin-top: 5px;">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">时间范围</label>
                                    <div class="layui-input-inline">
                                      <input class="layui-input StartTime" name="StartTime" value="{$_POST['StartTime']}" placeholder="开始时间" id="LAY_demorange_s">
                                    </div>
                                    <div class="layui-input-inline">
                                      <input class="layui-input EndTime" name="EndTime" value="{$_POST['EndTime']}" placeholder="结束时间" id="LAY_demorange_e">
                                    </div>
                                  </div>
                                </div>

                                <div class="layui-inline" style="margin-top: 5px;">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">零件名称</label>
                                    <div class="layui-input-inline">
                                      <input type="text" name="PartName" placeholder="全部" value="{$_POST['PartName']}" autocomplete="off" class="layui-input PartName">
                                    </div>
                                  </div>
                                </div>

                              </td>
                            </tr>
                          </tbody>
                          <tfoot>
                            <tr>
                              <td>
                                <button style="float:right;" class="layui-btn search_btn" type="submit" title="search_btn">搜索</button>
                              </td>
                            </tr>
                          </tfoot>
                        </table>
                    </form>
                    <script>
                        layui.use('laydate', function(){
                          var laydate = layui.laydate;
                          var start = {
                            format: 'YYYY-MM-DD hh:mm:ss'
                            ,istoday: false
                            ,choose: function(datas){
                              end.min = datas; //开始日选好后，重置结束日的最小日期
                              end.start = datas //将结束日的初始值设定为开始日
                            }
                          };

                          var end = {
                            format: 'YYYY-MM-DD hh:mm:ss'
                            ,istoday: false
                            ,choose: function(datas){
                              start.max = datas; //结束日选好后，重置开始日的最大日期
                            }
                          };

                          document.getElementById('LAY_demorange_s').onclick = function(){
                            start.elem = this;
                            laydate(start);
                          }

                          document.getElementById('LAY_demorange_e').onclick = function(){
                            end.elem = this
                            laydate(end);
                          }
                        });
                    </script>
                  </div>
                </div>
                <!-- 搜索  end -->
            </div>

            <div class="row">


                  <div class="col-xs-6">
                      <div class="panel panel-default">
                        <div class="panel-heading">生产记录</div>
                        <div class="panel-body" id="home">
                          <table id="grid-table"></table>
                          <div id="grid-pager"></div>
                        </div>
                      </div>
                  </div>

                  <div class="col-xs-6">
                      <div class="panel panel-default">
                        <div class="panel-heading">抽检记录</div>
                        <div class="panel-body" id="home-2">
                          <table id="grid-table-2"></table>
                          <div id="grid-pager-2"></div>
                        </div>
                      </div>
                  </div>


            </div>

            <div class="row">



                  <div class="col-xs-12">
                      <div class="panel panel-default">
                        <div class="panel-heading">图列显示</div>
                        <div class="panel-body">
                          <div class="row" id="drag__">
                            <style>
                                  #drag__ ul.tags{ list-style-type: none; margin: 0; padding: 0; margin-bottom: 10px; width: 100%;}
                                  #drag__ ul.tags li{display: block;height: 39px;line-height: 30px;border:0px;}
                                  #drag__ td{border: 1px solid #ccc!important;overflow: hidden;box-sizing: border-box;}

                                  #drag__ table td li{float: left;display: block;width:80%; overflow: hidden;}
                                  #drag__ .tags_box{display: block;height: 100%;width: 100%;position: absolute;left: 0;top: 0;overflow: hidden;color: #F90A0A;}
                                  #drag__ .red_tag{background: url('__PUBLIC__/flag.png') no-repeat right top;background-size: 20px;}

                                  .tags li{display: block;float: left;padding:0px;}
                                  .tags li span{margin-left: 28px;}

                                  #createtable table .tags_box{
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                    top: 0;
                                    float: left;
                                    overflow-y: auto;
                                    filter:chroma(color=black);
                                  }
                            </style>
                            <div class="col-sm-10">
                                <form class="layui-form" action="">
                                    <ul class="list-group tags">
                                      <li style="background: url('__PUBLIC__/Admin/images/error/bump.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-info">
                                          <input type="radio" name="error" value="Bump（凸点）" title="Bump（凸点）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/dent.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-warning">
                                          <input type="radio" name="error" value="Dent（凹点）" title="Dent（凹点）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/wave.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Wave（波浪）" title="Wave（波浪）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/Ridge.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Ridge（叠料）" title="Ridge（叠料）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/Line.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Line（冲压痕）" title="Line（冲压痕）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/Pressure-mark.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Pressure mark（压印）" title="Pressure mark（压印）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/Streching.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Streching（暗裂）" title="Streching（暗裂）">
                                      </li>

                                      <li style="background: url('__PUBLIC__/Admin/images/error/Cracking.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Cracking（开裂）" title="Cracking（开裂）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/Deformation.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Deformation（变形）" title="Deformation（变形）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/Cracking.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Wrinkling（起皱）" title="Wrinkling（起皱）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/Galling.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Galling（拉毛）" title="Galling（拉毛）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/Burr.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Burr（毛刺）" title="Burr（毛刺）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/LackofMaterial.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="LackofMaterial（缺料）" title="LackofMaterial（缺料）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/LackofHole.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="LackofHole（少孔）" title="LackofHole（少孔）">
                                      </li>
                                      <li style="background: url('__PUBLIC__/Admin/images/error/BadRAngle.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="BadRAngle（R角不良）" title="BadRAngle（R角不良）">
                                      </li>


                                      <li style="background: url('__PUBLIC__/Admin/images/error/Other.png') no-repeat 17px 10px;background-size: 33px;" class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="radio" name="error" value="Other（其他）" title="Other（其他）">
                                      </li>
                                    </ul>
                                    <input type="hidden" name="location" class="location">
                                    <button class="layui-btn hidden" lay-submit="" id="demo1_errors" lay-filter="demo1_errors">问题清单</button>
                                </form>
                            </div>
                            <div class="col-sm-2">
                                <select id="error_level">
                                    <option value="1" color="red">S300</option>
                                    <option value="2" color="red">A100</option>
                                    <option value="3" color="#FFD700">B50</option>
                                    <option value="4" color="#FFD700">B30</option>
                                    <option value="5" color="blue">C10</option>
                                </select>
                                <a href="javascript:;" class="btn btn-primary add_errors" title="add_errors" disabled="disabled">保存</a>
                            </div>
                          </div>






                          <div class="row">
                            <div class="col-sm-3" style="display: none;">
                                <div class="panel panel-default">
                                  <div class="panel-heading">已选问题</div>
                                  <div class="panel-body">

                                      <table class="layui-table">
                                        <colgroup>
                                          <col>
                                          <col width="207">
                                          <col width="56">
                                          <col>
                                        </colgroup>
                                        <thead>
                                          <tr>
                                            <th>序号</th>
                                            <th>问题</th>
                                            <th>等级</th>
                                            <th>操作</th>
                                          </tr>
                                        </thead>
                                        <tbody id="left_errors_box">

                                        </tbody>
                                      </table>

                                  </div>
                                </div>
                            </div>
                            <div class="col-sm-6" style="overflow-x: scroll;">

                                <form class="layui-form" action="">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">显示比例</label>
                                    <div class="layui-input-inline">
                                      <input type="text" id="bfb" name="bfb" placeholder="【0到1之间】" value="1" class="layui-input">
                                    </div>
                                  </div>
                                </form>


                                <div id="createtable"></div>
                                <input type="hidden" name="_width" id="_width">
                                <input type="hidden" name="_height" id="_height">
                                <script type="text/javascript">
                                    function CreateTable_initData(FlagMark,X_Count,Y_Count,P_Picture_url, _PartName, _ProductWorkOrderID, _CheckRecordID, bfb){
                                        //清表格
                                        $('#createtable').html('');

                                        var _red_tag_arr=[];
                                        var _red_tag_str=FlagMark;

                                        _red_tag_arr=_red_tag_str.split("YYY");

                                        var _array=[];
                                        var _json_location="";
                                        $.each(_red_tag_arr,function(key,value){　　
                                          _json_location=value.split("TTT");

                                          var _k=_json_location[0];
                                          var _v=_json_location[1];
                                          var _temp={_k,_v};
                                          _array.push(_temp);
                                        });


                                        // 图片地址
                                        var img_url = P_Picture_url;     //928*530

                                        // 创建对象
                                        var img = new Image();

                                        // 改变图片的src
                                        img.src = img_url;

                                        console.log(img_url)
                                        console.log(img.src)
                                        console.log(img.width)
                                        console.log(img.height)

                                        // 加载完成执行
                                        img.onload = function(){
                                            $('#_width').val(img.width);
                                            $('#_height').val(img.height);

                                            var _width=$('#_width').val();
                                            var _height=$('#_height').val();
                                            var rowCount=X_Count;
                                            var cellCount=Y_Count;

                                            var _table_data=_ajax_list_device_3(_PartName, _ProductWorkOrderID, _CheckRecordID);
console.log(88888);
                                            console.log(_table_data);

                                            _width=bfb*_width;
                                            _height=bfb*_height;

                                            if(_CheckRecordID>0){
                                                right_CreateTable(rowCount, cellCount, _width, _height, _table_data, _array, img_url);
                                            }else{
                                                left_CreateTable(rowCount, cellCount, _width, _height, _table_data, _array, img_url);
                                            }
                                        };
                                    }

                                    function left_CreateTable(rowCount,cellCount,_width,_height,_table_data,_red_tag_arr,img_url){

                                       var table=$("<table cellspacing='1' bordercolor='#990000' cellpadding='1' style=\"background: url('"+img_url+"') no-repeat;background-size: 100% 100%;margin:0 auto;\" width='"+_width+"' height='"+_height+"'>");
                                       table.appendTo($("#createtable"));

                                       for(var i=0;i<rowCount;i++)
                                       {
                                          var tr=$("<tr></tr>");
                                          tr.appendTo(table);
                                          for(var j=0;j<cellCount;j++)
                                          {
                                             var _row=i+1;
                                             var _col=j+1;

                                             var _location=_row+"_"+_col;
                                             var _counts=0;

                                             var div_innerhtml="";

                                             $.each(_table_data, function(i, value) {
                                                 if(_location == value.Location){
                                                      _counts=value.Num;
                                                      var _level=value.DefectLevel;
                                                      var _color=$('#error_level option[value='+_level+']').attr('color');
                                                      // div_innerhtml+="<a style='background:"+_color+";width:20px;height:20px;display:block;'></a>"
                                                 }
                                             });


                                             var ___td="<td style=\"border:1px solid #0CF328;position:relative;cursor: pointer;\" align='center' width='50' class='"+_row+"_"+_col+"'>";

                                                 if(_counts){
                                                    ___td+="<span style='position:absolute;bottom:0px;background-color: blue;color: white;display: block;height: 20px;line-height: 20px;min-width: 20px;font-size:9.6px; -webkit-transform-origin-x: 0;-webkit-transform: scale(0.80);'>"+changeY(_row)+_col+"_"+_counts+"</span>";                                                 }
                                                 ___td+="<span class='hidden location' style='position:absolute;right:0px;bottom:0px;background-color: green;color: white;display: block;height: 20px;line-height: 20px;width: auto;'>"+_row+"_"+_col+"</span>";


                                                 //左侧坐标
                                                 if(_row*_col==_row){
                                                     ___td+="<i style='position:absolute;width:16px;text-align:center;left:-20px;top:0px;background-color: blue;color: white;display: block;height: 20px;line-height: 20px;height: 100%;text-align:center;'>"+changeY(_row)+"</i>";
                                                 }

                                                 //顶部坐标
                                                 if(_row*_col==_col){
                                                     ___td+="<i style='position:absolute;left:0px;top:-20px;background-color: blue;color: white;display: block;height: 20px;line-height: 20px;width: 100%;text-align:center;'>"+_col+"</i>";
                                                 }

                                             ___td+="</td>";








                                             var td=$(___td);
                                             td.appendTo(tr);
                                          }
                                       }
                                       $("#createtable").append("</table>");



                                       //拖动---zhangtr
                                       $( ".sortable" ).sortable({
                                         revert: true
                                       });
                                       $( ".draggable" ).draggable({
                                         connectToSortable: "td .tags_box",
                                         helper: "clone",
                                         revert: "invalid"
                                       });
                                       $( "ul, li" ).disableSelection();


                                       //渲染小红旗
                                       $.each(_red_tag_arr,function(key,value){　
                                          if(value['_v']==1){
                                            $('#createtable tbody td.'+value['_k']+" div.tags_box").addClass('red_tag');
                                          }　
                                       })
                                    }

                                    function right_CreateTable(rowCount,cellCount,_width,_height,_table_data,_red_tag_arr,img_url){
                                       console.log(90);
                                       console.log(_table_data);
                                       console.log(1111111111);

                                       var table=$("<table cellspacing='1' bordercolor='#990000' cellpadding='1' style=\"background: url('"+img_url+"') no-repeat;background-size: 100% 100%;margin:0 auto;\" width='"+_width+"' height='"+_height+"'>");
                                       table.appendTo($("#createtable"));

                                       for(var i=0;i<rowCount;i++)
                                       {
                                          var tr=$("<tr></tr>");
                                          tr.appendTo(table);
                                          for(var j=0;j<cellCount;j++)
                                          {
                                             var _row=i+1;
                                             var _col=j+1;

                                             var _location=_row+"_"+_col;
                                             var _counts=0;

                                             var div_innerhtml="";

                                             $.each(_table_data, function(i, value) {
                                                 if(_location == value.Location){
                                                      _counts++;
                                                      var _level=value.DefectLevel;
                                                      var _error=value.Describe;
                                                      var _color=$('#error_level option[value='+_level+']').attr('color');
                                                      div_innerhtml+="<a class='old' style='background:"+_color+";width:11px;height:11px;display:block;border-radius: 50%;' data-error='"+_error+"' data-location='"+_location+"' data-level='"+_level+"'></a>"
                                                 }
                                             });



                                                  var ___td="<td style=\"border:1px solid #0CF328;position:relative;cursor: pointer;\" align='center' width='50' class='"+_row+"_"+_col+"'>";
                                                      ___td+="<div class='tags_box ui-state-default sortable'>"+div_innerhtml+"</div>";

                                                      ___td+="<span class='hidden location' style='position:absolute;right:0px;bottom:0px;background-color: green;color: white;display: block;height: 20px;line-height: 20px;width: auto;'>"+_row+"_"+_col+"</span>";

                                                      //左侧坐标
                                                      if(_row*_col==_row){
                                                          ___td+="<i style='position:absolute;width:16px;left:-20px;top:0px;background-color: blue;color: white;display: block;height: 20px;line-height: 20px;height: 100%;text-align:center;'>"+changeY(_row)+"</i>";
                                                      }

                                                      //顶部坐标
                                                      if(_row*_col==_col){
                                                          ___td+="<i style='position:absolute;left:0px;top:-20px;background-color: blue;color: white;display: block;height: 20px;line-height: 20px;width: 100%;text-align:center;'>"+_col+"</i>";
                                                      }


                                                  ___td+="</td>";



                                             var td=$(___td);
                                             td.appendTo(tr);
                                          }
                                       }
                                       $("#createtable").append("</table>");



                                       //拖动---zhangtr
                                       $( ".sortable" ).sortable({
                                         revert: true
                                       });
                                       $( ".draggable" ).draggable({
                                         connectToSortable: "td .tags_box",
                                         helper: "clone",
                                         revert: "invalid"
                                       });
                                       $( "ul, li" ).disableSelection();


                                       //渲染小红旗
                                       $.each(_red_tag_arr,function(key,value){　
                                          if(value['_v']==1){
                                            $('#createtable tbody td.'+value['_k']+" div.tags_box").addClass('red_tag');
                                          }　
                                       })
                                    }
                                </script>
                            </div>

                            <div class="col-sm-6" style="overflow-x: scroll;">
                                <div class="panel panel-default">
                                  <div class="panel-heading" style="position: relative;">
                                      问题列表
                                      <div id="error_search_box" style="position: absolute;top: 5px;left: 87px;">
                                          <select class="Describe">
                                              <option value="">请选择问题</option>
                                              <option value="Bump（凸点）">Bump（凸点）</option>
                                              <option value="Dent（凹点）">Dent（凹点）</option>
                                              <option value="Wave（波浪）">Wave（波浪）</option>
                                              <option value="Ridge（叠料）">Ridge（叠料）</option>
                                              <option value="Line（冲压痕）">Line（冲压痕）</option>
                                              <option value="Pressure mark（压印）">Pressure mark（压印）</option>
                                              <option value="Streching（暗裂）">Streching（暗裂）</option>



                                              <option value="Cracking（开裂）">Cracking（开裂）</option>
                                              <option value="Deformation（变形）">Deformation（变形）</option>
                                              <option value="Wrinkling（起皱）">Wrinkling（起皱）</option>
                                              <option value="Galling（拉毛）">Galling（拉毛）</option>
                                              <option value="Burr（毛刺）">Burr（毛刺）</option>
                                              <option value="LackofMaterial（缺料）">LackofMaterial（缺料）</option>
                                              <option value="LackofHole（少孔）">LackofHole（少孔）</option>
                                              <option value="BadRAngle（R角不良）">BadRAngle（R角不良）</option>

                                              <option value="Other（其他）">Other（其他）</option>
                                          </select>
                                          <select class="DefectLevel">
                                            <option value="">请选择等级</option>
                                            <option value="1">S300</option>
                                            <option value="2">A100</option>
                                            <option value="3">B50</option>
                                            <option value="4">B30</option>
                                            <option value="5">C10</option>
                                          </select>
                                          <input type="text" class="Position" placeholder="请输入坐标">
                                      </div>


                                      <button class="layui-btn layui-btn-small layui-btn-normal" id="export_list" style="position: absolute;right: 16px;top: 5px;">导出</button>
                                  </div>
                                  <div class="panel-body" id="home-3">
                                    <table id="grid-table-3"></table>
                                    <div id="grid-pager-3"></div>
                                  </div>
                                </div>
                            </div>
                          </div>
                        </div>
                      </div>
                  </div>

            </div>

          </div><!-- /.page-content -->

        </div><!-- /.main-content -->
        <!-- 右侧主要内容 end-->



        <!-- 模板相关设置 -->
        <include file="Public/ace-settings-container"/>

      </div><!-- /.main-container-inner -->



      <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">

        <i class="icon-double-angle-up icon-only bigger-110"></i>

      </a>

    </div><!-- /.main-container -->

    <!-- 底栏版本说明 -->
    <include file="Public/footer"/>

    <!-- basic scripts -->

    <!--[if !IE]> -->



    <!-- <![endif]-->



    <!--[if IE]>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<![endif]-->



    <!--[if !IE]> -->



    <script type="text/javascript">

      window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");

    </script>



    <!-- <![endif]-->



    <!--[if IE]>

<script type="text/javascript">

 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");

</script>

<![endif]-->



    <script type="text/javascript">

      if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");

    </script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/typeahead-bs2.min.js"></script>



    <!-- page specific plugin scripts -->

    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.custom.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/chosen.jquery.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/fuelux/fuelux.spinner.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-timepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/moment.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/daterangepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-colorpicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.knob.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.autosize.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.inputlimiter.1.3.1.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.maskedinput.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-tag.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.bootstrap.js"></script>

    <!-- 模块jqgrid  start -->
    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/jquery.jqGrid.min.js"></script>
    <!-- <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-en.js"></script> -->
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-zh.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.full.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>
    <!-- 模块jqgrid  end -->

    <!-- ace scripts -->



    <script src="__PUBLIC__/Admin/assets/js/ace-elements.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/ace.min.js"></script>



    <!-- inline scripts related to this page -->


    <script type="text/javascript">
      //数据列表初使化
      jQuery.support.cors=true;

      //获取列表
      function _ajax_list_device(ProductWorkOrderID, PartName, StartTime, EndTime){
          var grid_data;
          $.ajax({
              async:false,
              type:'get',
              url:'http://'+api_url+'/YPashx/ChongYaJian.ashx?TaskName=GetProductRecord',
              data:{
                ProductWorkOrderID:ProductWorkOrderID,
                PartName:PartName,
                StartTime:StartTime,
                EndTime:EndTime,
              },
              dataType : 'json',
              success  : function(json) {
                  if(json.code==0){
                      grid_data=json.data;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {
                  layer.msg(json.msg);
              }
          });
          return grid_data;
      }

      //获取列表
      function _ajax_list_gridTable_2(_data){
          var grid_data;
          $.ajax({
              async:false,
              type:'get',
              url : 'http://'+api_url+'/YPashx/ChongYaJian.ashx?TaskName=GetCheckRecord',
              data:_data,
              dataType : 'json',
              success  : function(json) {
                  if(json.code==0){
                      grid_data=json.data;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {
                  layer.msg(json.msg);
              }
          });
          return grid_data;
      }

      //获取列表
      function _ajax_list_gridTable_3(_data, _TaskID){
          var grid_data;
          $.ajax({
              async:false,
              type:'get',
              url : 'http://'+api_url+'/Default.ashx?TaskID='+_TaskID,
              data:_data,
              dataType : 'json',
              success  : function(json) {
                  if(json.code==0){
                      grid_data=json.data;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {
                  layer.msg(json.msg);
              }
          });
          return grid_data;
      }



      jQuery(function($) {
        var ProductWorkOrderID=$('#search_table .ProductWorkOrderID').val();
        var PartName=$('#search_table .PartName').val();
        var StartTime=$('#search_table .StartTime').val();
        var EndTime=$('#search_table .EndTime').val();

        var grid_data=_ajax_list_device(ProductWorkOrderID, PartName, StartTime, EndTime);
        jQuery(grid_selector).jqGrid({
          caption: "生产记录",
          data: grid_data,
          datatype: "local",
          height: 430,


          colNames:['RowNumber', 'PartID', 'ActualCheckNumColor',
                   '生产工单号','生产日期','零件名称', '计划生产数量' ,'实际生产数量','计划抽检次数','实际抽检次数','操作'],
          colModel:[
            {name:'RowNumber', index:'RowNumber', hidden: true, key:true},
            {name:'PartID', index:'PartID', hidden: true},
            {name:'ActualCheckNumColor',index:'ActualCheckNumColor', hidden: true},

            {name:'ProductWorkOrderID',index:'ProductWorkOrderID',  align : "center"},
            {name:'ProductDate',index:'ProductDate', align : "center"},
            {name:'PartName',index:'PartName', align : "center"},
            {name:'PlanProductNum',index:'PlanProductNum', align : "center"},
            {name:'ActualProductNum',index:'ActualProductNum', align : "center"},
            {name:'PlanCheckNum',index:'PlanCheckNum', align : "center"},
            {name:'ActualCheckNum',index:'ActualCheckNum', align : "center"},

            {name:'options',index:'options',align:'center'}
          ],


          rownumbers:true,
          rownumWidth:50,//设置行号列宽度
          autowidth:true,
          shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
          viewrecords : true,
          rowNum:10,
          rowList:[10,20,30],
          pager : pager_selector,
          altRows: true,
          multiselect: true,
          multiboxonly: true,

          loadComplete : function() {
            var table = this;
            setTimeout(function(){
              updatePagerIcons(table);
            }, 0);
          },

          onSelectRow : function(ids) {
              $('.add_errors').attr('disabled', 'disabled');

              var _rowData = $(grid_selector).jqGrid('getRowData',ids);
              var PartName=_rowData.PartName;
              var ProductWorkOrderID=_rowData.ProductWorkOrderID;
              var ProductDate=_rowData.ProductDate;
              var PartID=_rowData.PartID;

              //抽检记录
              var _data={
                ProductWorkOrderID:ProductWorkOrderID,
                ProductDate:ProductDate,
                PartID:PartID
              };
              render_gridTable_2(_data);

              //问题列表
              render_gridTable_3();

              //表格渲染
              var grid_data=_ajax_get_img_info();
              if(grid_data.code==0){
                    var data=grid_data.data[0];
                    console.log(56);
                    console.log(data);

                    var _FlagMark=data.FlagMark;
                    var _X_Count=data.X_Count;
                    var _Y_Count=data.Y_Count;
                    var _P_Picture=data.P_Picture;

                    var bfb=$('#bfb').val();

                    //渲染表格开始
                    CreateTable_initData(_FlagMark, _X_Count, _Y_Count, _P_Picture, PartName, ProductWorkOrderID, 0, bfb);
              }
          },

          gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
              var ids=jQuery(grid_selector).jqGrid('getDataIDs');
              for(var i=0; i<ids.length; i++){
                  var id=ids[i];

                  var _rowData = $(grid_selector).jqGrid('getRowData',id);

                  //红色
                  if(_rowData.ActualCheckNumColor==2){
                      $('#grid-table tr#'+id+' td[aria-describedby=grid-table_ActualCheckNum]').css('background', 'red');
                  }

                  //黄色
                  if(_rowData.ActualCheckNumColor==1){
                      $('#grid-table tr#'+id+' td[aria-describedby=grid-table_ActualCheckNum]').css('background', '#FFD700');
                  }

                  //绿色
                  if(_rowData.ActualCheckNumColor==0){
                      $('#grid-table tr#'+id+' td[aria-describedby=grid-table_ActualCheckNum]').css('background', 'green');
                  }
                  // 、、、、、、、、、

                  var options="";
                  options+= "<button class='btn btn-primary btn-xs id-btn-dialog2_add' title='id-btn-dialog2_add' data-workorderid='"+_rowData.WorkOrderDetailID+"' data-productworkorderid='"+_rowData.ProductWorkOrderID+"' data-partname='"+_rowData.PartsName+"'><i class='icon-edit bigger-110'></i>添加</button>";

                  jQuery(grid_selector).jqGrid('setRowData', ids[i], { options: options});
              }


              //②在gridComplete调用合并方法
              var gridName = "grid-table";
              Merger(gridName, 'M_Name');
          },
        });









        //初使化按钮操作权限
        var page="{$page}";
        _init_button_operate(page);
      });

      //自定义报警列格式
      function DefectLevelFormatter(cellvalue, options, rowdata){
          var _Level=['S300','A100','B50','B30','C10'];
          return '<span style="width:100px;height:50px;display:block;background:'+getLevelColor_by_num(cellvalue)+';">'+_Level[cellvalue-1]+'</span>';
      }

      function render_gridTable_2(_data){
          var grid_data=_ajax_list_gridTable_2(_data);
          console.log(111);
          console.log(grid_data);
          $('#home-2').html('<table id="grid-table-2"></table><div id="grid-pager-2"></div>');

          jQuery("#grid-table-2").jqGrid({
            caption : "抽检记录",
            data: grid_data,
            datatype: "local",


            colNames:['CheckRecordID', 'PartID', '生产工单号', '生产日期', '零件名称',  '抽检人', '抽检时间','零件孔数','实际孔数','孔径是否合格','翻边高度是否合格','面品是否合格', '检查结果', '操作'],
            colModel:[
              {name:'CheckRecordID', index:'CheckRecordID', hidden: true},
              {name:'PartID', index:'PartID', hidden: true},

              {name:'ProductWorkOrderID',index:'ProductWorkOrderID',align:"center"},
              {name:'ProductDate',index:'ProductDate',align:"center"},
              {name:'PartName',index:'PartName',align:"center"},
              {name:'CheckPerson',index:'CheckPerson',align:"center"},
              {name:'CheckTime',index:'CheckTime',align:"center"},

              {name:'PartHoleNum',index:'PartHoleNum',align:"center"},
              {name:'CheckHoleNum',index:'CheckHoleNum',align:"center"},
              {name:'ApertureResult',index:'ApertureResult',align:"center"},
              {name:'HighResult',index:'HighResult',align:"center"},
              {name:'SurfaceResult',index:'SurfaceResult',align:"center"},
              {name:'CheckResult',index:'CheckResult',align:"center"},

              {name:'options',index:'options',align:'center'}
            ],
            rownumbers:true,
            rownumWidth:50,//设置行号列宽度
            rowNum:10,
            rowList:[10,100,1000],
            pager : '#grid-pager-2',
            viewrecords : true,
            autowidth:true,
            shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
            height : 430,

            loadComplete : function(data) {
              var table = this;
              setTimeout(function(){
                updatePagerIcons(table);
              }, 0);
            },

            onSelectRow : function(ids) {
                $('.add_errors').removeAttr('disabled');

                var _rowData = $('#grid-table-2').jqGrid('getRowData',ids);

                var _CheckRecordID=_rowData.CheckRecordID;
                var _PartName=_rowData.PartName;
                var _ProductWorkOrderID=_rowData.ProductWorkOrderID;

55555555555
                console.log(_rowData);

                //给按钮添加属性add_errors
                $('.add_errors').attr('data-P_Number', _rowData.PartsNumber);
                $('.add_errors').attr('data-ProductWorkOrderId', _rowData.ProductWorkOrderId);
                $('.add_errors').attr('data-CheckRecordID', _rowData._CheckRecordID);


                //问题列表
                render_gridTable_3();


                //表格渲染
                var grid_data=_ajax_get_img_info(_PartName,_ProductWorkOrderID);
                if(grid_data.code==0){
                    var data=grid_data.data[0];
                    console.log(1000000);
                    console.log(grid_data);
                    var _FlagMark=data.FlagMark;
                    var _X_Count=data.X_Count;
                    var _Y_Count=data.Y_Count;
                    var _P_Picture=data.P_Picture;

                    var bfb=$('#bfb').val();

                    //渲染表格开始
                    CreateTable_initData(_FlagMark, _X_Count, _Y_Count, _P_Picture, _PartName, _ProductWorkOrderID, _CheckRecordID, bfb);
                }
            },

            gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
                var ids=jQuery("#grid-table-2").jqGrid('getDataIDs');
                for(var i=0; i<ids.length; i++){
                    var id=ids[i];
                    var _rowData = $("#grid-table-2").jqGrid('getRowData',id);

                    var PartHoleNum=_rowData.PartHoleNum;
                    var CheckHoleNum=_rowData.CheckHoleNum;

                    if(PartHoleNum != CheckHoleNum){
                        $('#grid-table-2 tr#'+id).css('background', 'red');
                    }

                    var options = "";
                        options+= "<button style='width:60px;margin-bottom:5px;' class='btn btn-primary btn-xs id-btn-dialog2_edit_2' title='id-btn-dialog2_edit_2' data-CheckRecordID='"+_rowData.CheckRecordID+"' data-checkresult='"+_rowData.CheckResult+"'><i class='icon-edit bigger-110'></i>修改</button><br>";
                        options+= "<button style='width:60px;' class='btn btn-danger btn-xs id-btn-dialog2_del_2' title='id-btn-dialog2_del_2' data-CheckRecordID='"+_rowData.CheckRecordID+"'><i class='icon-trash bigger-110'></i>删除</button>";
                    jQuery("#grid-table-2").jqGrid('setRowData', ids[i], { options: options});
                }
            },

          });
      }

      //问题列表
      function render_gridTable_3(){
          //参数
          var Describe=$('#error_search_box .Describe option:selected').val();
          var DefectLevel=$('#error_search_box .DefectLevel option:selected').val();
          var Position=$('#error_search_box .Position').val();

          var table_id = $('#grid-table').jqGrid('getGridParam', 'selrow');
          var rowData = $('#grid-table').jqGrid('getRowData',table_id);
          var PartName=rowData.PartName;
          var ProductWorkOrderID=rowData.ProductWorkOrderID;
          var CheckRecordID=rowData.CheckRecordID;

          var table_2_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');
          var rowData_2 = $('#grid-table-2').jqGrid('getRowData',table_2_id);




          var _data={
                Describe:Describe,
                DefectLevel:DefectLevel,
                Position:Position,
                PartName:PartName,
                ProductWorkOrderID:ProductWorkOrderID,
                CheckRecordID:CheckRecordID
          };


          //接口
          var table_2_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');
          if(table_2_id){
              var _TaskID=50210;
          }else{
              var _TaskID=5021;
          }


          var grid_data=_ajax_list_gridTable_3(_data, _TaskID);
          console.log(222);
          console.log(grid_data);
          $('#home-3').html('<table id="grid-table-3"></table><div id="grid-pager-3"></div>');
          jQuery("#grid-table-3").jqGrid({
            caption : "问题列表",
            data: grid_data,
            datatype: "local",
            colNames:['StoppageID', 'IsDelete', '坐标', '描述', '等级', '日期', '备注', '操作员', '操作'],
            colModel:[
              {name:'StoppageID',index:'StoppageID',  sorttype:"int",align : "center", hidden: true},
              {name:'IsDelete',index:'IsDelete',  sorttype:"int",align : "center", hidden: true},

              {name:'Position',index:'Position', align : "center"},
              {name:'Describe',index:'Describe', align : "center"},
              {name:'DefectLevel',index:'DefectLevel', align : "center", formatter: DefectLevelFormatter},
              {name:'CheckTime',index:'CheckTime', align : "center"},
              {name:'Remarks',index:'Remarks', align : "center"},
              {name:'CheckUser',index:'CheckUser', align : "center"},

              {name:'options',index:'options',align:'center',width:'200'}
            ],
            rownumbers:true,
            rownumWidth:50,//设置行号列宽度
            rowNum:10,
            rowList:[10,100,1000],
            pager : '#grid-pager-3',
            viewrecords : true,
            autowidth:true,
            shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
            height : 430,

            loadComplete : function(data) {
              var table = this;
              setTimeout(function(){
                updatePagerIcons(table);
              }, 0);
            },

            gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
                var ids=jQuery("#grid-table-3").jqGrid('getDataIDs');

                var no_data=0;
                for(var i=0; i<ids.length; i++){
                    var id=ids[i];
                    var _rowData = $("#grid-table-3").jqGrid('getRowData',id);

                    if(_rowData.StoppageID==0){
                        no_data++;
                    }

                    //已作废
                    if(_rowData.IsDelete==1){
                        var _disabled_=' disabled="disabled" ';
                        $('#grid-table-3 tbody tr#'+id).css("background-color","#ccc");
                    }else{
                        var _disabled_=' ';
                    }


                    var options="";
                    options += "<button "+_disabled_+" class='btn btn-primary btn-xs id-btn-dialog2_edit' title='id-btn-dialog2_edit' data-Describe='"+_rowData.Describe+"' data-Remarks='"+_rowData.Remarks+"' data-id='"+_rowData.StoppageID+"' style='margin-right:5px;'><i class='icon-edit bigger-110'></i>修改</button>";
                    options += "<button "+_disabled_+" class='btn btn-danger btn-xs id-btn-dialog2_del' title='id-btn-dialog2_del' data-id='"+_rowData.StoppageID+"'><i class='icon-trash bigger-110'></i>删除</button>";

                    jQuery("#grid-table-3").jqGrid('setRowData', ids[i], { options: options});
                }

                if(no_data>0){
                    $('#grid-table-3').jqGrid('clearGridData');
                }
            },

          });

          jQuery('#grid-table-3').closest(".ui-jqgrid-bdiv").css({ "overflow-x" : "hidden" });//去除jqgrid横向滚动条
      }

      //公共调用方法
      function Merger(gridName, CellName) {
          //得到显示到界面的id集合
          var mya = $("#" + gridName + "").getDataIDs();
          //当前显示多少条
          var length = mya.length;
          for (var i = 0; i < length; i++) {
              //从上到下获取一条信息
              var before = $("#" + gridName + "").jqGrid('getRowData', mya[i]);
              //定义合并行数
              var rowSpanTaxCount = 1;
              for (j = i + 1; j <= length; j++) {
                  //和上边的信息对比 如果值一样就合并行数+1 然后设置rowspan 让当前单元格隐藏
                  var end = $("#" + gridName + "").jqGrid('getRowData', mya[j]);
                  if (before[CellName] == end[CellName]) {
                      rowSpanTaxCount++;
                      $("#" + gridName + "").setCell(mya[j], CellName, '', { display: 'none' });
                  } else {
                      rowSpanTaxCount = 1;
                      break;
                  }
                  $("#" + CellName + "" + mya[i] + "").attr("rowspan", rowSpanTaxCount);
              }
          }
      }

      //replace icons with FontAwesome icons like above   //更新分页图标
      function updatePagerIcons(table) {
        var replacement =
        {
          'ui-icon-seek-first' : 'icon-double-angle-left bigger-140',
          'ui-icon-seek-prev' : 'icon-angle-left bigger-140',
          'ui-icon-seek-next' : 'icon-angle-right bigger-140',
          'ui-icon-seek-end' : 'icon-double-angle-right bigger-140'
        };
        $('.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon').each(function(){
          var icon = $(this);
          var $class = $.trim(icon.attr('class').replace('ui-icon', ''));

          if($class in replacement) icon.attr('class', 'ui-icon '+replacement[$class]);
        })
      }
    </script>

    <!-- 模板引擎doT.js    start -->
    <script id="j-tmpl_lingjian" type="text/template">
        {{ if(it.code==0){ }}

                {{ for (var i = 0, l = it.data.length; i < l; i++) { }}

                      <tr>
                        <td class="center">
                            <a href="#">序号</a>
                        </td>
                        <td class="center">
                            <a href="#">生产工单号</a>
                        </td>
                        <td class="center">
                            <a href="#">零件名称</a>
                        </td>
                        <td class="center">
                            <a href="#">零件编号</a>
                        </td>
                        <td class="center">
                            <a href="#">抽检人</a>
                        </td>
                        <td class="center">
                            <a href="#">抽检时间</a>
                        </td>
                        <td class="center">
                            检查结果
                        </td>
                      </tr>

                {{ } }}

        {{ }else{ }}

                <h2>暂无数据</h2>

        {{ } }}
    </script>

     <!-- 模板引擎doT.js    start -->
    <script id="j-tmpl_lingjian_dialog" type="text/template">
        {{ if(it.code==0){ }}

                {{ for (var i = 0, l = it.data.length; i < l; i++) { }}

                      <tr data-id="{{=it.data[i].RowID}}">
                        <td class="center">
                            <a href="#">{{=it.data[i].P_Name}}</a>
                        </td>
                      </tr>

                {{ } }}

        {{ }else{ }}

                <h2>暂无数据</h2>

        {{ } }}
    </script>

    <script src="__PUBLIC__/Admin/doT-master/doT.js"></script>
<!-- ============================= -->
    <!-- 添加模具 start-->
    <div id="dialog-confirm" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">

            <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                <tbody id="liaoliao_box">
                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">模具名称</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="模具名称" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">制作厂家</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="制作厂家" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-2">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">生产线</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="生产线" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">负责人</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="负责人" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-3">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">状态</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="状态" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                    </td>
                  </tr>

                  <tr>
                    <td colspan="2" style="text-align:right;">
                      <a href="javascript:;" class="layui-btn add_row">
                        <i class="layui-icon">&#xe608;</i> 添加
                      </a>
                    </td>
                  </tr>

                </tbody>
            </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->


    <!-- 确认弹框 start-->
    <div id="dialog-confirm_add" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="">

            <table class="table table-striped table-bordered table-hover" id="add_cjjl_form">
                <tbody>
                  <tr>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">零件名称</label>
                          <div class="layui-input-inline">
                            <input type="text" name="PartName" lay-verify="required" readonly placeholder="零件名称" class="layui-input PartName">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">工单编号</label>
                          <div class="layui-input-inline">
                            <input type="text" name="ProductWorkOrderID" lay-verify="required" readonly placeholder="工单编号" class="layui-input ProductWorkOrderID">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">零件孔数</label>
                          <div class="layui-input-inline">
                            <input type="text" name="PartHoleNum" lay-verify="required" readonly placeholder="零件孔数" class="layui-input PartHoleNum">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">实际孔数</label>
                          <div class="layui-input-inline">
                            <input type="text" name="CheckHoleNum" lay-verify="required" placeholder="实际孔数" class="layui-input CheckHoleNum">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td colspan="2" class="left">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label width_175">孔径是否合格</label>
                            <div class="layui-input-inline">
                                <input type="radio" name="ApertureResult" class="ApertureResult" value="1" title="OK" lay-filter="OK_Radio_add">
                                <input type="radio" name="ApertureResult" class="ApertureResult" value="0" title="NOK" lay-filter="OK_Radio_add">
                            </div>
                          </div>
                        </div>

                    </td>
                  </tr>
                  <tr>
                    <td colspan="2" class="left">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label width_175">翻边高度是否合格</label>
                            <div class="layui-input-inline">
                                <input type="radio" name="HighResult" class="HighResult" value="1" title="OK" lay-filter="OK_Radio_add">
                                <input type="radio" name="HighResult" class="HighResult" value="0" title="NOK" lay-filter="OK_Radio_add">
                            </div>
                          </div>
                        </div>

                    </td>
                  </tr>
                  <tr>
                    <td colspan="2" class="left">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label width_175">面品是否合格</label>
                            <div class="layui-input-inline">
                                <input type="radio" name="SurfaceResult" class="SurfaceResult" value="1" title="OK" lay-filter="OK_Radio_add">
                                <input type="radio" name="SurfaceResult" class="SurfaceResult" value="0" title="NOK" lay-filter="OK_Radio_add">
                            </div>
                          </div>
                        </div>
                    </td>
                  </tr>

                  <tr>
                    <td colspan="2" class="left">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">记录人</label>
                            <div class="layui-input-inline">
                                <input type="text" name="CheckPerson" lay-verify="required" readonly placeholder="记录人" autocomplete="off" class="layui-input CheckPerson">
                            </div>
                          </div>
                        </div>

                    </td>
                  </tr>

                  <tr>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label width_175">检查结果</label>
                          <div class="layui-input-inline CheckResult_box">
                              <input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格" checked="">
                              <input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="left">
                      <input type="hidden" name="WorkOrderDetailID" class='WorkOrderDetailID'>
                      <input type="hidden" name="ProductDate" class='ProductDate'>
                      <input type="hidden" name="PartID" class='PartID'>
                      <button style="float:right;" class="layui-btn demo1_add_cjjl" lay-submit="" lay-filter="demo1_add_cjjl">确认</button>
                    </td>
                  </tr>
                </tbody>
              </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 确认弹框 start-->
    <div id="dialog-confirm_edit_2" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="">

            <table class="table table-striped table-bordered table-hover" id="edit_2_form">
                <tbody>
                  <tr>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">零件名称</label>
                          <div class="layui-input-inline">
                            <input type="text" name="PartName" lay-verify="required" readonly placeholder="零件名称" autocomplete="off" class="layui-input PartName">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">工单编号</label>
                          <div class="layui-input-inline">
                            <input type="text" name="ProductWorkOrderID" lay-verify="required" readonly placeholder="工单编号" autocomplete="off" class="layui-input ProductWorkOrderID">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">零件孔数</label>
                          <div class="layui-input-inline">
                            <input type="text" name="PartHoleNum" lay-verify="required" readonly placeholder="零件孔数" autocomplete="off" class="layui-input PartHoleNum">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="left">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">实际孔数</label>
                          <div class="layui-input-inline">
                            <input type="text" name="CheckHoleNum" lay-verify="required" placeholder="实际孔数" autocomplete="off" class="layui-input CheckHoleNum">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td colspan="2" class="left">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label width_175">孔径是否合格</label>
                            <div class="layui-input-inline">
                                <input type="radio" name="ApertureResult" class="ApertureResult" value="1" title="OK" lay-filter="OK_Radio_edit">
                                <input type="radio" name="ApertureResult" class="ApertureResult" value="0" title="NOK" lay-filter="OK_Radio_edit">
                            </div>
                          </div>
                        </div>

                    </td>
                  </tr>
                  <tr>
                    <td colspan="2" class="left">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label width_175">翻边高度是否合格</label>
                            <div class="layui-input-inline">
                                <input type="radio" name="HighResult" class="HighResult" value="1" title="OK" lay-filter="OK_Radio_edit">
                                <input type="radio" name="HighResult" class="HighResult" value="0" title="NOK" lay-filter="OK_Radio_edit">
                            </div>
                          </div>
                        </div>

                    </td>
                  </tr>
                  <tr>
                    <td colspan="2" class="left">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label width_175">面品是否合格</label>
                            <div class="layui-input-inline">
                                <input type="radio" name="SurfaceResult" class="SurfaceResult" value="1" title="OK" lay-filter="OK_Radio_edit">
                                <input type="radio" name="SurfaceResult" class="SurfaceResult" value="0" title="NOK" lay-filter="OK_Radio_edit">
                            </div>
                          </div>
                        </div>

                    </td>
                  </tr>

                  <tr>
                    <td colspan="2" class="left">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">记录人</label>
                            <div class="layui-input-inline">
                                <input type="text" name="CheckPerson" lay-verify="required" readonly placeholder="记录人" autocomplete="off" class="layui-input CheckPerson">
                            </div>
                          </div>
                        </div>

                    </td>
                  </tr>

                  <tr>
                    <td class="left">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label width_175">检查结果</label>
                            <div class="layui-input-inline CheckResult_box">
                                <input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格" checked="">
                                <input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格">
                            </div>
                          </div>
                        </div>

                    </td>
                    <td class="left">
                      <input type="hidden" name="CheckRecordID" class='CheckRecordID'>
                      <button style="float:right;" class="layui-btn demo1_edit_2" lay-submit="" lay-filter="demo1_edit_2">确认</button>
                    </td>
                  </tr>
                </tbody>
              </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 添加模具工序 start-->
    <div id="dialog-confirm_gongxu" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">

            <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                <tbody id="liaoliao_box">
                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">模具编号</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="模具编号" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">工序名称</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="工序名称" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-2">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">长</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="长" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">宽</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="宽" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-3">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">高</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="高" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">上模重量</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="高" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">高</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="高" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">上模重量</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="上模重量" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>



                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">下模重量</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="下模重量" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">下模高度</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="下模高度" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>


                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">装模高度</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="装模高度" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">闭合高度</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="闭合高度" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">压边力</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="压边力" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">成型力</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="成型力" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>


                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">保养周期（根据次数）</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="保养周期（根据次数）" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">保养周期（根据时间）</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="保养周期（根据时间）" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">制造厂家</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="制造厂家" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">负责人</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="负责人" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td colspan="2" style="text-align:right;">
                      <a href="javascript:;" class="layui-btn add_row">
                        <i class="layui-icon">&#xe608;</i> 添加
                      </a>
                    </td>
                  </tr>

                </tbody>
            </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->


    <!-- 选择零件 start-->
    <div id="dialog-confirm_select_lingjian" class="hide">
       <div class="row">
              <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                  <tbody id="lingjian_box">
                    <tr>
                      <td class="center">
                          <a class="layui-btn layui-btn-normal">合格</a>
                      </td>
                      <td class="center">
                          <a class="layui-btn layui-btn-warm">不合格</a>
                      </td>
                    </tr>
                  </tbody>
              </table>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 选择车型 start-->
    <div id="dialog-confirm_select_chexing" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">
              <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                  <tbody id="chexing_box">
                    <tr>
                      <td class="center">
                          3213213131
                      </td>
                    </tr>
                  </tbody>
                </table>
           </form>
        </div>
    </div><!-- #dialog-confirm -->


    <!-- 确认弹框 start-->
    <div id="dialog-confirm_edit" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="">

            <table class="table table-striped table-bordered table-hover" id="error_edit_form">
                <tbody>
                  <tr>
                    <td colspan="2" class="center">
                        <textarea name="Remarks" placeholder="描述" class="layui-textarea Remarks"></textarea>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="2" style="text-align:right;">
                      <input class="layui-input StoppageID" type="hidden" name="StoppageID">
                      <button class="layui-btn" lay-submit="" lay-filter="demo1_error_edit">确认</button>
                    </td>
                  </tr>
                </tfoot>
              </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 确认弹框 start-->
    <div id="dialog-confirm_del" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="">

            <table class="table table-striped table-bordered table-hover" id="error_del_form">
                <tbody>
                  <tr>
                    <td colspan="2" class="center">
                        <textarea name="Remarks" placeholder="描述" class="layui-textarea Remarks"></textarea>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="2" style="text-align:right;">
                      <input class="layui-input StoppageID" type="hidden" name="StoppageID">
                      <button class="layui-btn" lay-submit="" lay-filter="demo1_error_del">确认</button>
                    </td>
                  </tr>
                </tfoot>
              </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <script type="text/javascript">

      jQuery(function($) {
          // 默认为1级状态
          $('.layui-form-radio i').css("color",'red');
          jQuery.support.cors=true;


          $('#bfb').blur(function(){
              var table_id = $('#grid-table').jqGrid('getGridParam', 'selrow');
              var table_2_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');

              if(table_2_id>0){
                  $('#grid-table-2 tr#'+table_2_id).trigger('click');
              }else{
                  $('#grid-table tr#'+table_id).trigger('click');
              }
          });

          $('#bfb').keydown(function(){
              if(event.keyCode==13){
                  var table_id = $('#grid-table').jqGrid('getGridParam', 'selrow');
                  var table_2_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');

                  if(table_2_id>0){
                      $('#grid-table-2 tr#'+table_2_id).trigger('click');
                  }else{
                      $('#grid-table tr#'+table_id).trigger('click');
                  }

                  return false;
              }
          });


          //
          $('#add_cjjl_form .CheckHoleNum').blur(function(){
              var PartHoleNum=$('#add_cjjl_form .PartHoleNum').val();
              var CheckHoleNum=$('#add_cjjl_form .CheckHoleNum').val();

              if(PartHoleNum!=CheckHoleNum){
                  $('#add_cjjl_form .CheckHoleNum').css('background-color', 'red');
              }else{
                  $('#add_cjjl_form .CheckHoleNum').removeAttr('style');
              }
          });


          //删除已选问题
          $('body').on('click', '#left_errors_box tr .del', function(){
              $(this).parent('li').remove();

              var error=$(this).attr('data-error');
              $('.tags_box a[data-error="'+error+'"]').remove();
              $('.tags_box li[data-error="'+error+'"]').remove();
          });

          // 问题列表搜索
          $('#error_search_box .Describe,.DefectLevel').change(function(){
              render_gridTable_3();
          });
          $('#error_search_box .Position').blur(function(){
              render_gridTable_3();
          });

          $('body').on('click','#createtable td',function(){
              $( ".location" ).val($(this).attr('class'));
              $( "#demo1_errors" ).trigger('click');

              //重置问题的选择状态
              $('#drag__ .tags li input').removeAttr('checked');
              layui.form().render();
              $('#error_level option[value=1]').attr("selected",'selected');
              $('.layui-form-radio i').css("color",'red');
          });

          $("#error_level").change(function(){
              var level=$("#error_level").find("option:selected").attr("value");
              var color=getLevelColor_by_num(level);
              console.log(level);
              $('.layui-form-radio i').css("color", color);

          });

          //添加模具
          $( ".id-btn-dialog2" ).on('click', function(e) {
            e.preventDefault();

            $( "#dialog-confirm" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              title_html: true
            });

            $("div[aria-describedby='dialog-confirm'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 添加模具：</h4></div>");
          });

          //添加模具工序
          $( ".id-btn-dialog2_gongxu" ).on('click', function(e) {
            e.preventDefault();

            $( "#dialog-confirm_gongxu" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              title_html: true
            });

            $("div[aria-describedby='dialog-confirm_gongxu'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 添加模具工序：</h4></div>");
          });

          //选择 －－－  零件出现弹框
          $( ".id-btn-dialog2_select_lingjian" ).on('click', function(e) {
            e.preventDefault();

            $( "#dialog-confirm_select_lingjian" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              title_html: true,
              buttons: [
                {
                  html: "<i class='icon-remove bigger-110'></i>&nbsp; 取消",
                  "class" : "btn btn-xs",
                  click: function() {
                    $( this ).dialog( "close" );
                  }
                }
              ]
            });

            $("div[aria-describedby='dialog-confirm_select_lingjian'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 新建：</h4></div>");
          });

          //选择 －－－  车型出现弹框
          $( ".id-btn-dialog2_select_chexing" ).on('click', function(e) {
            e.preventDefault();

            _ajax_get_chexing_dialog_list();

            $( "#dialog-confirm_select_chexing" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              width:400,
              height:500,
              title_html: true,
              buttons: [
                {
                  html: "<i class='icon-remove bigger-110'></i>&nbsp; 取消",
                  "class" : "btn btn-xs",
                  click: function() {
                    $( this ).dialog( "close" );
                  }
                }
              ]
            });

            $("div[aria-describedby='dialog-confirm_select_chexing'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 选择车型：</h4></div>");
          });

          //修改缺陷记录
          $( "body" ).on('click',  '.id-btn-dialog2_edit', function(e) {
            e.preventDefault();

            var id=$(this).attr('data-id');
            var Remarks=$(this).attr('data-Remarks');
            $('#error_edit_form .StoppageID').val(id);
            $('#error_edit_form .Remarks').val(Remarks);

            $( "#dialog-confirm_edit" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              width:800,
              title_html: true,
            });

            $("div[aria-describedby='dialog-confirm_edit'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 修改缺陷记录：</h4></div>");
          });

          //删除缺陷记录
          $( "body" ).on('click',  '.id-btn-dialog2_del', function(e) {
            e.preventDefault();

            var table_3_id = $('#grid-table-3').jqGrid('getGridParam', 'selrow');
            var table_3_rowData = $('#grid-table-3').jqGrid('getRowData',table_3_id);

            var id=table_3_rowData.StoppageID;
            var Remarks=table_3_rowData.Remarks;
            $('#error_del_form .StoppageID').val(id);
            $('#error_del_form .Remarks').val(Remarks);

            $( "#dialog-confirm_del" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              width:800,
              title_html: true,
            });

            $("div[aria-describedby='dialog-confirm_del'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 删除缺陷记录：</h4></div>");
          });

          // //删除缺陷记录
          // $( "body" ).on('click',  '.id-btn-dialog2_del', function(e) {
          //   e.preventDefault();
          //   var id=$(this).attr('data-id');

          //   if(confirm("确定要删除选中项？")){
          //       var _json=_ajax_error_del(id);

          //       if(_json.code==0){
          //           var sel_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');
          //           $('#grid-table-2 tr#'+sel_id).trigger('click');
          //       }
          //   }

          // });


          //删除缺陷记录
          $( "body" ).on('click',  '.id-btn-dialog2_del_2', function(e) {
            e.preventDefault();
            var CheckRecordID=$(this).attr('data-CheckRecordID');

            if(confirm("确定要删除选中项？")){
                var _json=_ajax_error_del_2(CheckRecordID);

                if(_json.code==0){
                    var sel_id = $('#grid-table').jqGrid('getGridParam', 'selrow');
                    $('#grid-table tr#'+sel_id).trigger('click');
                }
            }

          });


          //点击右侧零件里面的tr删除一条
          $( "body" ).on('click','#_lingjian_list tr .del_lingjian', function() {
              var _mould_id=$('#right_lingjian_btn').attr('data-mould-id');
              var _part_id=$(this).attr('data-id');

              var json=_ajax_del_lingjian_of_mould_relation(_mould_id,_part_id);

              if(json.code==0){
                  $(this).parents('tr').remove();
              }
          });


          //添加抽检记录
          $( "body" ).on('click', '.id-btn-dialog2_add', function(e) {
            e.preventDefault();

            var _id = $('#grid-table').jqGrid('getGridParam', 'selrow');
            var rowData = $('#grid-table').jqGrid('getRowData',_id);

            //获取零件附加信息
            var partInfo=_ajax_get_part_info(rowData.PartID);

            var PartName=partInfo.PartName;
            var PartHoleNum=partInfo.PartHoleNum;

            var PartID=rowData.PartID;
            var CheckPerson=login_user;
            var ProductWorkOrderID=rowData.ProductWorkOrderID;
            var ProductDate=rowData.ProductDate;

            $('#add_cjjl_form .PartName').val(PartName);
            $('#add_cjjl_form .PartHoleNum').val(PartHoleNum);
            $('#add_cjjl_form .CheckPerson').val(CheckPerson);
            $('#add_cjjl_form .ProductWorkOrderID').val(ProductWorkOrderID);
            $('#add_cjjl_form .ProductDate').val(ProductDate);
            $('#add_cjjl_form .PartID').val(PartID);

            var Obj_json=[
                {'name_1':'HighResult', 'value_1':1},
                {'name_1':'SurfaceResult', 'value_1':1},
                {'name_1':'ApertureResult', 'value_1':1}
            ];

            var num=1;
            for (var i = 0; i < Obj_json.length; i++) {
                  var name_1=Obj_json[i].name_1;
                  var value_1=Obj_json[i].value_1;

                  $('#add_cjjl_form .'+name_1+'[value='+value_1+']').attr('checked',true)

                  $('#add_cjjl_form .demo1_add_cjjl').attr(name_1, value_1);

                  num*=value_1;
            }

            if(num==1){
                  var str='<input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格" checked>'
                         +'<input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格">';
            }else{
                  var str='<input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格">'
                         +'<input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格" checked>';
            }
            $('#add_cjjl_form .CheckResult_box').html(str);




            $( "#dialog-confirm_add" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              width:800,
              title_html: true,
            });

            $("div[aria-describedby='dialog-confirm_add'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 添加抽检记录：</h4></div>");

            layui.form().render();
          });

          //修改抽检记录
          $( "body" ).on('click', '.id-btn-dialog2_edit_2', function(e) {
            e.preventDefault();


            //获取
            var _id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');
            var rowData = $('#grid-table-2').jqGrid('getRowData',_id);

            $('#edit_2_form .PartName').val(rowData.PartName);
            $('#edit_2_form .ProductWorkOrderID').val(rowData.ProductWorkOrderID);
            $('#edit_2_form .PartHoleNum').val(rowData.PartHoleNum);
            $('#edit_2_form .CheckHoleNum').val(rowData.CheckHoleNum);

            $('#edit_2_form .CheckPerson').val(rowData.CheckPerson);
            $('#edit_2_form .CheckRecordID').val(rowData.CheckRecordID);

            $("#edit_2_form :radio[name='HighResult'][value='" + rowData.HighResult + "']").prop("checked", "checked");
            $("#edit_2_form :radio[name='SurfaceResult'][value='" + rowData.SurfaceResult + "']").prop("checked", "checked");
            $("#edit_2_form :radio[name='ApertureResult'][value='" + rowData.ApertureResult + "']").prop("checked", "checked");
            $("#edit_2_form :radio[name='CheckResult'][value='" + rowData.CheckResult + "']").prop("checked", "checked");

            if(rowData.CheckHoleNum!=rowData.PartHoleNum){
                 $('#edit_2_form .CheckHoleNum').css('background', 'red');
            }else{
                 $('#edit_2_form .CheckHoleNum').removeAttr('style');
            }



            var Obj_json=[
                {'name_1':'HighResult', 'value_1':rowData.HighResult},
                {'name_1':'SurfaceResult', 'value_1':rowData.SurfaceResult},
                {'name_1':'ApertureResult', 'value_1':rowData.ApertureResult}
            ];

            var num=1;
            for (var i = 0; i < Obj_json.length; i++) {
                  var name_1=Obj_json[i].name_1;
                  var value_1=Obj_json[i].value_1;

                  $('#edit_2_form .'+name_1+'[value='+value_1+']').attr('checked',true)

                  $('#edit_2_form .demo1_edit_2').attr(name_1, value_1);

                  num*=value_1;
            }

            if(num==1){
                  var str='<input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格" checked>'
                         +'<input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格">';
            }else{
                  var str='<input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格">'
                         +'<input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格" checked>';
            }
            $('#edit_2_form .CheckResult_box').html(str);




            layui.form().render();

            $( "#dialog-confirm_edit_2" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              width:800,
              title_html: true,
            });

            $("div[aria-describedby='dialog-confirm_edit_2'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 修改抽检记录：</h4></div>");

          });


          //保存缺陷记录
          $( "body" ).on('click','.add_errors',function() {
              var _rowData =fn_get_gridTable_rowData('#grid-table-2');

              var _PartID=_rowData.PartID;
              var _ProductWorkOrderID=_rowData.ProductWorkOrderID;
              var _CheckRecordID=_rowData.CheckRecordID;
              var _CheckUser=login_user;


              if( _ProductWorkOrderID && _CheckRecordID && _CheckUser ){
                  var _str='{"data":[';
                  $.each($('.tags_box li'),function(name,value){　
                      var _Location=$(value).attr('data-location');
                      var _Level=$(value).attr('data-level');
                      var _Describe=$(value).html();
                      if($('.tags_box li').length-1==name){
                          _str+='{"Location":"'+_Location+'","DefectLevel":"'+_Level+'","Describe":"'+_Describe+'","PartID":"'+_PartID+'","OrderID":"'+_ProductWorkOrderID+'","CheckRecordID":"'+_CheckRecordID+'","CheckUser":"'+_CheckUser+'"}';
                      }else{
                          _str+='{"Location":"'+_Location+'","DefectLevel":"'+_Level+'","Describe":"'+_Describe+'","PartID":"'+_PartID+'","OrderID":"'+_ProductWorkOrderID+'","CheckRecordID":"'+_CheckRecordID+'","CheckUser":"'+_CheckUser+'"},';
                      }
                  });
                  _str+=']}';

                  _ajax_add_errors(_str);
              }else{
                  layer.msg('请选择抽检记录');
              }
          });


          //导出问题列表
          $('#export_list').click(function(){
              var sel_id = $(grid_selector).jqGrid('getGridParam', 'selrow');
              var _rowData = $(grid_selector).jqGrid('getRowData',sel_id);
              var _PartsName=_rowData.PartsName;
              var _WorkOrderDetailID=_rowData.WorkOrderDetailID;

              if(_PartsName&&_WorkOrderDetailID){
                  $.ajax({
                      async:false,
                      type:'get',
                      contentType:"application/x-www-form-urlencoded",
                      url : 'http://'+api_url+'/Default.ashx?TaskID=6001&partname='+_PartsName+'&orderid='+_WorkOrderDetailID,
                      dataType : 'json',
                      success  : function(json) {
                          if(json.code==0){
                              var download_url='http://'+api_url+'/'+json.data;
                              // console.log(download_url);
                              window.location.href=download_url;
                          }else{
                              layer.msg(json.msg);
                          }
                      },
                      error  : function(json) {
                          layer.msg(json.msg);
                      }
                  });
              }
          });


          $('#createtable').on('mouseenter','.tags_box',function(){
              $(this).parent('td').find('.location').removeClass('hidden');
          });
          $('#createtable').on('mouseout','.tags_box',function(){
              $(this).parent('td').find('.location').addClass('hidden');
          });
      });

      //
      function _ajax_add_errors(_data){
          var _json;
          $.ajax({
              async:false,
              type:'post',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5022',
              data: _data,
              dataType : 'json',
              success  : function(json) {
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;

                      var sel_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');
                      $('#grid-table-2 tr#'+sel_id).trigger('click');
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {
                  layer.msg('error');
              }
          });
          return _json;
      }


      //异步请求____零件
      function _ajax_get_right_lingjian_list(_id){
          var _data={"MouldID":_id};
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=3027',
              data: _data,
              dataType : 'json',
              success  : function(json) {
                  console.log('11111111111111111111111');
                  console.log(json);
                  if(json.code == 0){
                      var obj = json;
                      var tmpl = document.getElementById('j-tmpl_lingjian').innerHTML;
                      var doTtmpl = doT.template(tmpl);
                      var doT_Str=doTtmpl(obj);
                      $('#_lingjian_list').html(doT_Str);
                  }else{
                      alert(json.msg);
                  }
              },
              error  : function() {
                  alert('error');
              }
          });
      }

      //异步请求____车型
      function _ajax_get_right_chexing_list(_id){
          var _data={"MouldID":_id};
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=3017',
              data: _data,
              dataType : 'json',
              success  : function(json) {
                  if(json.code == 0){
                      var obj = json;
                      var tmpl = document.getElementById('j-tmpl_chexing').innerHTML;
                      var doTtmpl = doT.template(tmpl);
                      var doT_Str=doTtmpl(obj);
                      $('#_chexing_list').html(doT_Str);
                  }else{
                      alert(json.msg);
                  }
              },
              error  : function() {
                  alert('error');
              }
          });
      }

      //异步请求所有零件
      function _ajax_get_lingjian_dialog_list(){
          $.ajax({
              async:false,
              type:'post',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=3021',
              dataType : 'json',
              success  : function(json) {
                  if(json.code == 0){
                      var obj = json;
                      var tmpl = document.getElementById('j-tmpl_lingjian_dialog').innerHTML;
                      var doTtmpl = doT.template(tmpl);
                      var doT_Str=doTtmpl(obj);
                      $('#lingjian_box').html(doT_Str);
                  }else{
                      alert(json.msg);
                  }
              },
              error  : function() {
                  alert('error');
              }
          });
      }

      //异步请求所有车型
      function _ajax_get_chexing_dialog_list(){
          $.ajax({
              async:false,
              type:'post',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=3011',
              dataType : 'json',
              success  : function(json) {
                  if(json.code == 0){
                      var obj = json;
                      var tmpl = document.getElementById('j-tmpl_chexing_dialog').innerHTML;
                      var doTtmpl = doT.template(tmpl);
                      var doT_Str=doTtmpl(obj);
                      $('#chexing_box').html(doT_Str);
                  }else{
                      alert(json.msg);
                  }
              },
              error  : function() {
                  alert('error');
              }
          });
      }

      //
      function _ajax_error_edit(data){
        var _data=data.field;

        var StoppageID=_data.StoppageID;
        var Remarks=_data.Remarks;

        var _json;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5023&id='+StoppageID+'&remarks='+Remarks,
              dataType : 'json',
              success  : function(json) {
                  console.log(json);
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;

                      var ID=$("#grid-table-3").getGridParam("selrow");
                      $("#grid-table-3").setRowData(ID, json.data);

                      $("div[aria-describedby='dialog-confirm_edit'] .ui-dialog-titlebar-close").trigger("click");
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {
                  layer.msg('error');
              }
          });
          return _json;
      }

      //
      function _ajax_error_del(data){
        var _data=data.field;

        var StoppageID=_data.StoppageID;
        var Remarks=_data.Remarks;

        var _json;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5024&id='+StoppageID+'&remarks='+Remarks,
              dataType : 'json',
              success  : function(json) {
                  console.log(json);
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;

                      var ID=$("#grid-table-3").getGridParam("selrow");
                      $("#grid-table-3").setRowData(ID, json.data);

                      $("div[aria-describedby='dialog-confirm_del'] .ui-dialog-titlebar-close").trigger("click");

                      $('#grid-table-3 tbody tr#'+ID).attr('disabled','disabled');
                      $('#grid-table-3 tbody tr#'+ID).css("background-color","#ccc");
                      $('#grid-table-3 tbody tr#'+ID+' button').attr("disabled","disabled");
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {
                  layer.msg('error');
              }
          });
          return _json;
      }

      //
      function _ajax_error_del1111(id){

          var _json;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5024&id='+id,
              dataType : 'json',
              success  : function(json) {
                  console.log(json);
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {
                  layer.msg('error');
              }
          });
          return _json;
      }

      function _ajax_error_del_2(CheckRecordID){

          var _json;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url:'http://'+api_url+'/YPashx/ChongYaJian.ashx?TaskName=DeleteCheckRecord',
              data:{
                CheckRecordID:CheckRecordID
              },
              dataType : 'json',
              success  : function(json) {
                  console.log(json);
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {
                  layer.msg('error');
              }
          });
          return _json;
      }

      //异步给模具添加零件
      function _ajax_add_lingjian_for_mould(_mould_id,_part_id){

          var _data={"MouldID":_mould_id,"PartID":_part_id};

          var _json;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=2018',
              data: _data,
              dataType : 'json',
              success  : function(json) {
                  if(json.code == 0){
                      _json=json;
                  }else{
                      _json=json;
                  }
              },
              error  : function() {
                  alert('error');
              }
          });

          return _json;
      }

      //异步添加抽检记录
      function _ajax_add_cjjl(data){
        var _data=JSON.stringify(data.field);

        var _json;
          $.ajax({
              async:false,
              type:'post',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/YPashx/ChongYaJian.ashx?TaskName=InsertCheckRecord',
              data:_data,
              dataType : 'json',
              success  : function(json) {
                  console.log(json);
                  if(json.code == 0){
                      layer.msg(json.msg);

                      var selected_data=fn_get_gridTable_rowData('#grid-table');
                      var ActualCheckNum=selected_data.ActualCheckNum*1+1;
                      var _id=$("#grid-table").getGridParam("selrow");
                      $("#grid-table").setCell(_id, 'ActualCheckNum', ActualCheckNum);

                      _json=json;
                  }else{
                      layer.msg(json.msg);
                      _json=json;
                  }
              },
              error  : function() {
                  layer.msg('error');
              }
          });
          return _json;
      }

      function changeY(num){
          var _str="ABCDEFGHIGKLMNOPQRSTUVWXYZ";

              _str=_str+_str.toLowerCase();
          return _str[num-1];
      }


      function getLevelColor_by_name(name){
          var colorObj={
                S300 : 'red',
                A100 : 'red',
                B50 : '#FFD700',
                B30 : '#FFD700',
                C10 : 'blue'
              };
          return colorObj[name];
      }

      function getLevelColor_by_num(num){
          var colorObj={
                1 : 'red',
                2 : 'red',
                3 : '#FFD700',
                4 : '#FFD700',
                5 : 'blue'
              };
          return colorObj[num];
      }


      //异步修改抽检记录
      function _ajax_edit_2(data){
          var _data=data.field;
              _data.CheckPerson=login_user;

          var data=JSON.stringify(_data);

          var _json;
          $.ajax({
              async:false,
              type:'post',
              contentType:"application/x-www-form-urlencoded",
              url:'http://'+api_url+'/YPashx/ChongYaJian.ashx?TaskName=UpdateCheckRecord',
              data:data,
              dataType : 'json',
              success  : function(json) {
                  console.log(json);
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;

                      var selectID=$("#grid-table-2").getGridParam("selrow");
                      $("#grid-table-2").setRowData(selectID,_data);

                      $("div[aria-describedby='dialog-confirm_edit_2'] .ui-dialog-titlebar-close").trigger("click");
                  }else{
                      $("div[aria-describedby='dialog-confirm_edit_2'] .ui-dialog-titlebar-close").trigger("click");
                      layer.msg(json.msg);
                      _json=json;
                  }
              },
              error  : function() {
                  layer.msg('error');
              }
          });
          return _json;
      }

      //异步删除模具的零件的对应关系
      function _ajax_del_lingjian_of_mould_relation(_mould_id,_part_id){

          var _data={"MouldID":_mould_id,"PartID":_part_id};

          var _json;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=2019',
              data: _data,
              dataType : 'json',
              success  : function(json) {
                console.log(json);
                  if(json.code == 0){
                      _json=json;
                  }else{
                      _json=json;
                  }
              },
              error  : function() {
                  alert('error');
              }
          });

          return _json;
      }

      //异步删除模具的车型的对应关系
      function _ajax_del_chexing_of_mould_relation(_mould_id,_car_id){

          var _data={"MouldID":_mould_id,"CarID":_car_id};

          var _json;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=2112',
              data: _data,
              dataType : 'json',
              success  : function(json) {
                console.log(json);
                  if(json.code == 0){
                      _json=json;
                  }else{
                      _json=json;
                  }
              },
              error  : function() {
                  alert('error');
              }
          });

          return _json;
      }


      //获取渲染图片所需要的信息
      function _ajax_get_img_info(){
          //参数
          var Describe=$('#error_search_box .Describe option:selected').val();
          var DefectLevel=$('#error_search_box .DefectLevel option:selected').val();
          var Position=$('#error_search_box .Position').val();

          var _id = $('#grid-table').jqGrid('getGridParam', 'selrow');
          var rowData = $('#grid-table').jqGrid('getRowData',_id);
          var PartName=rowData.PartName;
          var ProductWorkOrderID=rowData.ProductWorkOrderID;

          var _data={
                Describe:Describe,
                DefectLevel:DefectLevel,
                Position:Position,
                PartName:PartName,
                ProductWorkOrderID:ProductWorkOrderID
          };

          var grid_data;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5020',
              data: _data,
              dataType : 'json',
              success  : function(json) {
                  if(json){
                      grid_data=json;
                  }
              },
              error  : function(json) {
                  layer.msg(json.msg);
              }
          });
          return grid_data;
      }

      //获取零件附加信息
      function _ajax_get_part_info(PartID){
          var grid_data;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url:'http://'+api_url+'/YPashx/ChongYaJian.ashx?TaskName=GetPartAdditionalInfo',
              data: {
                PartID:PartID,
              },
              dataType : 'json',
              success  : function(json) {
                  if(json.code==0){
                      grid_data=json.data;
                  }
              },
              error  : function(json) {
                  layer.msg(json.msg);
              }
          });
          return grid_data;
      }

      //获取图片上的问题次数相关信息
      function _ajax_list_device_3(_PartName,_order_id,_CheckRecordID){
          if(_CheckRecordID){
              var _URL='http://'+api_url+'/Default.ashx?TaskID=50213&PartName='+_PartName+'&ProductWorkOrderID='+_order_id+'&CheckRecordID='+_CheckRecordID;
          }else{
              var _URL='http://'+api_url+'/Default.ashx?TaskID=50211&PartName='+_PartName+'&ProductWorkOrderID='+_order_id;
          }

          var grid_data_3;
          $.ajax({
              async:false,
              type:'get',
              contentType:"application/x-www-form-urlencoded",
              url : _URL,
              dataType : 'json',
              success  : function(json) {
                  if(json.code==0){
                      grid_data_3=json.data;
                  }else{
                      grid_data_3=json.data;
                  }
              },
              error  : function(json) {
                  layer.msg(json.msg);
              }
          });

          console.log(grid_data_3);
          return grid_data_3;
      }
    </script>

    <script>
        layui.use(['form', 'laydate'], function(){
          var form = layui.form()
          ,layer = layui.layer
          ,layedit = layui.layedit
          ,laydate = layui.laydate;

          //自定义验证规则
          form.verify({
            title: function(value){
              if(value.length < 5){
                return '标题至少得5个字符啊';
              }
            }
            ,pass: [/(.+){6,12}$/, '密码必须6到12位']
            ,content: function(value){
              layedit.sync(editIndex);
            }
          });

          //监听提交
          form.on('submit(demo1_errors)', function(data){
            var location=data.field.location;
            var level=$("#error_level").find("option:selected").val();
            var error=data.field.error;
            var color=getLevelColor_by_num($("#error_level").find("option:selected").attr("value"));

            var count=0;
            $.each($('td.'+location+' .tags_box a') ,function(name, value){
                if($(value).attr('data-error')==error){
                    count++;
                }
            });
            if(count>0){
                layer.msg('该问题已存在');
                return false;
            }

            if(!error){
                // layer.msg('请选择问题');
            }else{
                var _str="";
                _str+="<li style='display:none;' data-error='"+error+"' data-location='"+location+"' data-level='"+level+"'>"+error+"</li>";
                _str+="<a class='new' style='background:"+color+";width:11px;height:11px;display:block;border-radius: 50%;' data-error='"+error+"' data-location='"+location+"' data-level='"+level+"'></a>";
console.log(_str);
                $('td.'+location+' .tags_box').append(_str);
            }


            //渲染已选择问题列表
            var left_errors="";
            $.each($('td.'+location+' .tags_box a') ,function(name, value){
                var error=$(value).attr('data-error');
                var level=$(value).attr('data-level');

                console.log(error);
                switch(error){
                    case 'Bump（凸点）':
                        var img_url="__PUBLIC__/Admin/images/error/bump.png";
                        console.log(img_url);
                        break;
                    case 'Dent（凹点）':
                        var img_url="__PUBLIC__/Admin/images/error/dent.png";
                        console.log(img_url);
                        break;
                    case 'Wave（波浪）':
                        var img_url="__PUBLIC__/Admin/images/error/wave.png";
                        console.log(img_url);
                        break;
                    case 'Ridge（叠料）':
                        var img_url="__PUBLIC__/Admin/images/error/Ridge.png";
                        console.log(img_url);
                        break;
                    case 'Line（冲压痕）':
                        var img_url="__PUBLIC__/Admin/images/error/Line.png";
                        console.log(img_url);
                        break;
                    case 'Pressure mark（压印）':
                        var img_url="__PUBLIC__/Admin/images/error/Pressure-mark.png";
                        console.log(img_url);
                        break;
                    case 'Streching（暗裂）':
                        var img_url="__PUBLIC__/Admin/images/error/Streching.png";
                        console.log(img_url);
                        break;

                    case 'Cracking（开裂）':
                        var img_url="__PUBLIC__/Admin/images/error/Cracking.png";
                        break;
                    case 'Deformation（变形）':
                        var img_url="__PUBLIC__/Admin/images/error/Deformation.png";
                        break;
                    case 'Wrinkling（起皱）':
                        var img_url="__PUBLIC__/Admin/images/error/Wrinkling.png";
                        break;
                    case 'Galling（拉毛）':
                        var img_url="__PUBLIC__/Admin/images/error/Galling.png";
                        break;
                    case 'Burr（毛刺）':
                        var img_url="__PUBLIC__/Admin/images/error/Burr.png";
                        break;
                    case 'LackofMaterial（缺料）':
                        var img_url="__PUBLIC__/Admin/images/error/LackofMaterial.png";
                        break;
                    case 'LackofHole（少孔）':
                        var img_url="__PUBLIC__/Admin/images/error/LackofHole.png";
                        break;
                    case 'BadRAngle（R角不良）':
                        var img_url="__PUBLIC__/Admin/images/error/BadRAngle.png";
                        break;
                    case 'Other（其他）':
                        var img_url="__PUBLIC__/Admin/images/error/Other.png";
                        console.log(img_url);
                        break;
                    default:
                        var img_url="__PUBLIC__/Admin/images/error/eye.png";
                        console.log(img_url);
                        break;
                }



                if($(value).hasClass('new')){

                    left_errors+='<tr>'+
                                  '<td>'+name+'</td>'+
                                  '<td>'+
                                      '<span style="background: url('+img_url+') no-repeat 17px 10px;background-size: 33px;" class="list-group-item" data-location="'+location+'" data-error="'+error+'">'+$(value).attr('data-error')+'</span>'+
                                  '</td>'+
                                  '<td>'+level+'级</td>'+
                                  '<td>'+
                                      '<span class="badge del" data-error="'+error+'">X</span>'+
                                  '</td>'+
                                '</tr>';


                }else{
                    left_errors+='<tr>'+
                                  '<td>'+name+'</td>'+
                                  '<td>'+
                                      '<span style="background: url('+img_url+') no-repeat 17px 10px;background-size: 33px;" class="list-group-item error_name" data-location="'+location+'" data-error="'+error+'">'+$(value).attr('data-error')+'</span>'+
                                  '</td>'+
                                  '<td>'+level+'级</td>'+
                                  '<td>'+
                                  '</td>'+
                                '</tr>';
                }
            });

            console.log(left_errors);

            $('#left_errors_box').html(left_errors);
            return false;
          });

          //监听提交
          form.on('radio(OK_Radio_add)', function(data){
            var _name=data.elem.name;
            var _value=data.value;

            console.log(_name);
            console.log(_value);


            $('#add_cjjl_form .demo1_add_cjjl').attr(_name, _value);

            //是否有NOK选中
            var ApertureResult        =parseInt($('#add_cjjl_form .demo1_add_cjjl').attr('ApertureResult'));
            var HighResult            =parseInt($('#add_cjjl_form .demo1_add_cjjl').attr('HighResult'));
            var SurfaceResult         =parseInt($('#add_cjjl_form .demo1_add_cjjl').attr('SurfaceResult'));


            if(ApertureResult&&HighResult&&SurfaceResult){
                  var str='<input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格" checked>'
                         +'<input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格">';
            }else{
                  var str='<input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格">'
                         +'<input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格" checked>';
            }
            $('#add_cjjl_form .CheckResult_box').html(str);

            layui.form().render();
            return false;
          });


          //监听提交
          form.on('radio(OK_Radio_edit)', function(data){
            var _name=data.elem.name;
            var _value=data.value;

            console.log(_name);
            console.log(_value);


            $('#edit_2_form .demo1_edit_2').attr(_name, _value);

            //是否有NOK选中
            var ApertureResult        =parseInt($('#edit_2_form .demo1_edit_2').attr('ApertureResult'));
            var HighResult            =parseInt($('#edit_2_form .demo1_edit_2').attr('HighResult'));
            var SurfaceResult         =parseInt($('#edit_2_form .demo1_edit_2').attr('SurfaceResult'));


            if(ApertureResult&&HighResult&&SurfaceResult){
                  var str='<input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格" checked>'
                         +'<input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格">';
            }else{
                  var str='<input type="radio" name="CheckResult" class="CheckResult" value="合格" title="合格">'
                         +'<input type="radio" name="CheckResult" class="CheckResult" value="不合格" title="不合格" checked>';
            }
            $('#edit_2_form .CheckResult_box').html(str);

            layui.form().render();
            return false;
          });

          //监听提交 添加抽检记录
          form.on('submit(demo1_add_cjjl)', function(data){

            var _json=_ajax_add_cjjl(data);

            if(_json.code==0){
                $("div[aria-describedby='dialog-confirm_add'] .ui-dialog-titlebar-close").trigger("click");
                // $("#grid-table-2").addRowData("1", _json.data, "first");

                var sel_id = $('#grid-table').jqGrid('getGridParam', 'selrow');
                $('#grid-table tr#'+sel_id).trigger('click');

                $('#add_cjjl_form .CheckHoleNum').removeAttr('style').val('');
            }

            if(_json.code==1){
                $("div[aria-describedby='dialog-confirm_add'] .ui-dialog-titlebar-close").trigger("click");
            }

            return false;
          });


          //监听提交 修改抽检记录
          form.on('submit(demo1_edit_2)', function(data){
            var _json=_ajax_edit_2(data);
            return false;
          });


          //监听提交
          form.on('submit(demo1_error_edit)', function(data){
            var _json=_ajax_error_edit(data);

            return false;
          });

          //监听提交
          form.on('submit(demo1_error_del)', function(data){
            var _json=_ajax_error_del(data);

            return false;
          });


          //监听提交
          form.on('submit(demo1_search)', function(data){
            layer.alert(JSON.stringify(data.field), {
              title: '最终的提交信息'
            })
            return false;
          });
        });
    </script>
  </body>
</html>
